<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Catalyst Core: Character Tracker (Clean)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet"/>
<link rel="stylesheet" href="styles/main.css"/>
</head>
<body>

<!-- Firebase config is loaded from firebase-config.json -->

<header>
  <div class="top">
    <h1>Catalyst Core: Character Tracker</h1>
    <div class="actions">
      <button id="btn-enc" class="icon" aria-label="Encounter / Initiative" title="Encounter / Initiative">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"/>
        </svg>
      </button>
      <button id="btn-load" class="icon" aria-label="Load" title="Load">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"/>
        </svg>
      </button>
      <button id="btn-save" class="icon" aria-label="Save" title="Save">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5"/>
        </svg>
      </button>
      <button id="btn-log"  class="icon" aria-label="Roll/Flip Log" title="Roll/Flip Log">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 0 1 0 3.75H5.625a1.875 1.875 0 0 1 0-3.75Z"/>
        </svg>
      </button>
      <button id="btn-rules" class="icon" aria-label="Open Rules (CCCG)" title="Open Rules (CCCG)">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25"/>
        </svg>
      </button>
    </div>
  </div>
  <div class="tabs">
    <button class="tab active" data-go="combat">Combat</button>
    <button class="tab" data-go="abilities">Abilities</button>
    <button class="tab" data-go="powers">Powers</button>
    <button class="tab" data-go="gear">Gear</button>
    <button class="tab" data-go="story">Story</button>
  </div>
</header>

<main>
  <!-- COMBAT -->
  <section data-tab="combat">
    <h2>Tools</h2>
    <div class="grid grid-2">
      <div class="card">
        <label>Dice Roller</label>
        <div class="inline">
          <select id="dice-sides"><option>4</option><option>6</option><option>8</option><option>10</option><option>12</option><option selected>20</option><option>100</option></select>
          <input id="dice-count" type="number" inputmode="numeric" min="1" value="1" style="max-width:120px"/>
          <button id="roll-dice" style="max-width:160px">Roll</button>
        </div>
        <div class="small" id="dice-out"></div>
      </div>
      <div class="card">
        <label>Coin Flip</label>
        <div class="inline">
          <button id="flip">Flip</button>
          <span class="pill" id="flip-out"></span>
        </div>
      </div>
    </div>
  </section>

  <section data-tab="combat">
    <h2>Combat Stats</h2>
    <div class="grid grid-2">
      <div class="card">
        <label>HP</label>
        <div class="inline">
          <progress id="hp-bar" max="10" value="10" style="width:100%"></progress>
          <span class="pill" id="hp-pill">10/10</span>
        </div>
        <div class="inline">
          <input id="hp-roll" type="number" inputmode="numeric" placeholder="Tier Roll"/>
          <input id="hp-bonus" type="number" inputmode="numeric" placeholder="Bonus HP"/>
        </div>
        <div class="inline">
          <input id="hp-temp" type="number" inputmode="numeric" placeholder="Temp HP"/>
          <input id="hp-amt" type="number" inputmode="numeric" placeholder="Amount"/>
          <button id="hp-dmg" class="btn-sm">Damage</button>
          <button id="hp-heal" class="btn-sm">Heal</button>
          <button id="hp-full" class="btn-sm">Reset HP</button>
        </div>
      </div>
      <div class="card">
        <label>SP</label>
        <div class="inline">
          <progress id="sp-bar" max="5" value="5" style="width:100%"></progress>
          <span class="pill" id="sp-pill">5/5</span>
        </div>
        <div class="inline">
          <input id="sp-temp" type="number" inputmode="numeric" placeholder="Temp SP"/>
          <button class="btn-sm" data-sp="-1">-1 SP</button>
          <button class="btn-sm" data-sp="-2">-2 SP</button>
          <button class="btn-sm" data-sp="-3">-3 SP</button>
          <button id="sp-full" class="btn-sm">Reset SP</button>
        </div>
        <div class="inline"><button id="long-rest" class="btn-sm">Long Rest</button></div>
      </div>
    </div>

    <div class="grid grid-2">
      <div class="card">
        <label>Initiative</label>
        <input id="initiative" type="number" inputmode="numeric" placeholder="auto from DEX + bonuses" readonly/>
        <label>Speed (ft)</label>
        <input id="speed" type="number" inputmode="numeric" placeholder="30"/>
      </div>
      <div class="card">
        <label>Passive Perception</label>
        <input id="pp" type="number" readonly/>
        <label>Armor/Shield Bonus (auto)</label>
        <input id="armor-bonus" type="number" readonly/>
        <label>Power/Origin Bonus</label>
        <input id="origin-bonus" type="number" inputmode="numeric" value="0"/>
        <label>TC</label>
        <input id="tc" type="number" readonly/>
      </div>
    </div>
  </section>

  <!-- ABILITIES -->
  <section data-tab="abilities">
    <h2>Ability Scores</h2>
    <div class="grid grid-3" id="abil-grid"></div>
    <div class="card">
      <div class="inline">
        <div style="flex:1">
          <label>Proficiency Bonus</label>
          <input id="prof-bonus" type="number" inputmode="numeric" value="2"/>
        </div>
        <div style="flex:1">
          <label>Power Save Ability</label>
          <select id="power-save-ability">
            <option value="str">STR</option><option value="dex">DEX</option><option value="con">CON</option>
            <option value="int">INT</option><option value="wis" selected>WIS</option><option value="cha">CHA</option>
          </select>
        </div>
        <div style="flex:1">
          <label>Power Save DC</label>
          <input id="power-save-dc" type="number" readonly/>
        </div>
      </div>
    </div>
  </section>

  <!-- POWERS -->
  <section data-tab="powers">
    <div class="inline" style="justify-content:space-between">
      <h2>Powers</h2>
      <button id="add-power" style="max-width:180px">Add Power</button>
    </div>
    <div class="grid grid-2" id="powers"></div>

    <div class="inline" style="justify-content:space-between;margin-top:8px">
      <h2>Signature Moves</h2>
      <button id="add-sig" style="max-width:200px">Add Signature Move</button>
    </div>
    <div class="grid grid-2" id="sigs"></div>
  </section>

  <!-- GEAR -->
  <section data-tab="gear">
    <h2>Gear</h2>
    <div class="grid grid-2">
      <div class="card">
        <div class="inline" style="justify-content:space-between">
          <label>Weapons</label><button id="add-weapon" class="btn-sm" style="max-width:140px">Add Weapon</button>
        </div>
        <div id="weapons" class="grid grid-1"></div>
      </div>
      <div class="card">
        <div class="inline" style="justify-content:space-between">
          <label>Armor & Protection</label><button id="add-armor" class="btn-sm" style="max-width:160px">Add Armor</button>
        </div>
        <div id="armors" class="grid grid-1"></div>
      </div>
      <div class="card" style="grid-column:1/-1">
        <div class="inline" style="justify-content:space-between">
          <label>Gear & Items</label>
          <div class="inline">
            <button id="add-item" class="btn-sm" style="max-width:140px">Add Item</button>
            <button id="open-catalog" class="btn-sm" style="max-width:160px">Open Gear Catalog</button>
          </div>
        </div>
        <div id="items" class="grid grid-1"></div>
      </div>
    </div>
  </section>

  <!-- STORY -->
  <section data-tab="story">
    <h2>Character & Story</h2>
    <div class="grid grid-2">
      <div class="card"><label>Superhero Identity</label><input id="superhero" placeholder="Vigil name"/></div>
      <div class="card"><label>Secret Identity</label><input id="secret" placeholder="Real name"/></div>
      <div class="card">
        <label>Public Identity</label>
        <select id="publicIdentity"><option value="Public">Public</option><option value="Secret" selected>Secret</option></select>
      </div>
      <div class="card">
        <label>Tier</label>
        <select id="tier">
          <option>Tier 5 – Rookie</option>
          <option>Tier 4 – Emerging Vigilante</option>
          <option>Tier 3 – Field-Tested Operative</option>
          <option>Tier 2 – Respected Force</option>
          <option>Tier 1 – Heroic Figure</option>
          <option>Tier 0 – Transcendent</option>
        </select>
      </div>
      <div class="card">
        <label>Alignment</label>
        <select id="alignment">
          <option>Paragon (Lawful Light)</option>
          <option>Guardian (Neutral Light)</option>
          <option>Vigilante (Chaotic Light)</option>
          <option>Sentinel (Lawful Neutral)</option>
          <option>Outsider (True Neutral)</option>
          <option>Wildcard (Chaotic Neutral)</option>
          <option>Inquisitor (Lawful Shadow)</option>
          <option>Anti-Hero (Neutral Shadow)</option>
          <option>Renegade (Chaotic Shadow)</option>
        </select>
      </div>
      <div class="card">
        <label>Classification</label>
        <select id="classification">
          <option>Mutant</option><option>Enhanced Human</option><option>Magic User</option><option>Alien/Extraterrestrial</option><option>Mystical Being</option>
        </select>
      </div>
      <div class="card">
        <label>Primary Power Style</label>
        <select id="power-style">
          <option>Physical Powerhouse</option><option>Energy Manipulator</option><option>Speedster</option>
          <option>Telekinetic/Psychic</option><option>Illusionist</option><option>Shape-shifter</option><option>Elemental Controller</option>
        </select>
      </div>
      <div class="card">
        <label>Secondary Power Style</label>
        <select id="power-style-2">
          <option>None</option>
          <option>Physical Powerhouse</option><option>Energy Manipulator</option><option>Speedster</option>
          <option>Telekinetic/Psychic</option><option>Illusionist</option><option>Shape-shifter</option><option>Elemental Controller</option>
        </select>
      </div>
    </div>

    <div class="card">
      <label>Backstory / Notes</label>
      <textarea id="story-notes" rows="6" placeholder="Key events, allies, vulnerabilities, research/training notes, etc."></textarea>
    </div>
  </section>
</main>

<!-- INITIATIVE MODAL -->
<div class="overlay hidden" id="modal-enc">
  <div class="modal">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3>Encounter Tracker</h3>
    <div class="inline" style="margin-bottom:6px"><span class="pill" id="round-pill">Round 1</span></div>
    <div class="inline">
      <input id="enc-name" placeholder="Name"/>
      <input id="enc-init" type="number" inputmode="numeric" placeholder="Init"/>
      <button id="enc-add" class="btn-sm">Add</button>
    </div>
    <div id="enc-list" class="catalog" style="margin-top:8px"></div>
    <div class="actions">
      <button id="enc-next" class="btn-sm">Next Round</button>
      <button id="enc-reset" class="btn-sm">Reset</button>
    </div>
  </div>
</div>

<!-- LOG MODAL -->
<div class="overlay hidden" id="modal-log">
  <div class="modal">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3>Recent Log</h3>
    <div class="grid grid-2">
      <div><label>Dice</label><div id="log-dice" class="catalog"></div></div>
      <div><label>Coins</label><div id="log-coin" class="catalog"></div></div>
    </div>
    <div class="actions"><button class="btn-sm" data-close>Close</button></div>
  </div>
</div>

<!-- SAVE / LOAD -->
<div class="overlay hidden" id="modal-save">
  <div class="modal">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3>Save Character</h3>
    <label>Save name</label>
    <input id="save-key" placeholder="e.g., Shawn"/>
    <div class="actions"><button id="do-save">Save</button></div>
  </div>
</div>
<div class="overlay hidden" id="modal-load">
  <div class="modal">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3>Load Character</h3>
    <label>Save name</label>
    <input id="load-key" placeholder="Enter save name"/>
    <div class="actions"><button id="do-load">Load</button></div>
  </div>
</div>

<!-- GEAR CATALOG -->
<div class="overlay hidden" id="modal-catalog">
  <div class="modal" style="max-width:900px">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3>Gear Catalog</h3>
    <div class="inline" style="margin:6px 0">
      <select id="catalog-filter-style" style="max-width:260px"></select>
      <select id="catalog-filter-type" style="max-width:180px"><option value="">All Types</option><option>Armor</option><option>Shield</option><option>Utility</option></select>
      <select id="catalog-filter-rarity" style="max-width:160px"><option value="">All Rarities</option><option>Common</option><option>Uncommon</option><option>Rare</option><option>Elite</option><option>Legendary</option></select>
      <input id="catalog-search" placeholder="Search..."/>
    </div>
    <div id="catalog-list" class="catalog"></div>
  </div>
</div>

<!-- RULES (CCCG PDF) -->
<div class="overlay hidden" id="modal-rules">
  <div class="modal" style="max-width:960px;height:80vh">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3>CCCG — Character Creation Guide</h3>
    <div style="height:calc(100% - 40px)">
      <iframe src="./CCCCG - Catalyst Core Character Creation Guide.pdf" title="CCCG PDF" style="width:100%;height:100%;border:1px solid var(--line);border-radius:8px"></iframe>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script type="module" src="scripts/main.js"></script>
</body>
</html>
