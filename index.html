<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"/>
<meta name="description" content="Mobile-optimized character tracker for the Catalyst Core RPG."/>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link rel="icon" href="images/LOGO.PNG" type="image/png"/>
<meta name="theme-color" content="#0e1117"/>
<meta name="color-scheme" content="dark light"/>
<title>Catalyst Core</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet"/>
<link rel="stylesheet" href="styles/main.css"/>
</head>
<body>
<noscript>This app requires JavaScript to run properly.</noscript>

<a href="#main" class="skip-link">Skip to main content</a>


<header>
  <div class="top">
    <span class="tabs-title"><img src="images/LOGO.PNG" alt="Catalyst Core logo" class="logo"/>Catalyst Core</span>
    <div class="dropdown">
      <button id="btn-menu" class="icon" aria-label="Menu" title="Menu" aria-haspopup="true" aria-expanded="false" aria-controls="menu-actions" type="button">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 6.75h15m-15 5.25h15m-15 5.25h15"/>
        </svg>
      </button>
      <div id="menu-actions" class="menu" hidden>
        <button id="btn-load" class="btn-sm">Load</button>
        <button id="btn-enc" class="btn-sm" aria-label="Encounter / Initiative" title="Encounter / Initiative">Encounter / Initiative</button>
        <button id="btn-log" class="btn-sm">Roll/Flip Log</button>
        <button id="btn-campaign" class="btn-sm">Campaign Log</button>
        <button id="btn-rules" class="btn-sm">Rules</button>
        <button id="btn-help" class="btn-sm">Help</button>
        <button id="btn-fun" class="btn-sm">Fun Tip</button>
        <button id="btn-save" class="btn-sm">Save</button>
      </div>
    </div>
  </div>
  <nav class="tabs" role="tablist" aria-label="Primary">
    <button class="tab active" data-go="combat" aria-label="Combat" title="Combat" role="tab" aria-current="page" type="button">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <polyline stroke-linecap="round" stroke-linejoin="round" points="14.5 17.5 3 6 3 3 6 3 17.5 14.5"/>
        <line stroke-linecap="round" stroke-linejoin="round" x1="13" y1="19" x2="19" y2="13"/>
        <line stroke-linecap="round" stroke-linejoin="round" x1="16" y1="16" x2="20" y2="20"/>
        <line stroke-linecap="round" stroke-linejoin="round" x1="19" y1="21" x2="21" y2="19"/>
      </svg>
    </button>
    <button class="tab" data-go="abilities" aria-label="Abilities" title="Abilities" role="tab" type="button">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9.8132 15.9038L9 18.75L8.1868 15.9038C7.75968 14.4089 6.59112 13.2403 5.09619 12.8132L2.25 12L5.09619 11.1868C6.59113 10.7597 7.75968 9.59112 8.1868 8.09619L9 5.25L9.8132 8.09619C10.2403 9.59113 11.4089 10.7597 12.9038 11.1868L15.75 12L12.9038 12.8132C11.4089 13.2403 10.2403 14.4089 9.8132 15.9038Z"/>
        <path stroke-linecap="round" stroke-linejoin="round" d="M18.2589 8.71454L18 9.75L17.7411 8.71454C17.4388 7.50533 16.4947 6.56117 15.2855 6.25887L14.25 6L15.2855 5.74113C16.4947 5.43883 17.4388 4.49467 17.7411 3.28546L18 2.25L18.2589 3.28546C18.5612 4.49467 19.5053 5.43883 20.7145 5.74113L21.75 6L20.7145 6.25887C19.5053 6.56117 18.5612 7.50533 18.2589 8.71454Z"/>
        <path stroke-linecap="round" stroke-linejoin="round" d="M16.8942 20.5673L16.5 21.75L16.1058 20.5673C15.8818 19.8954 15.3546 19.3682 14.6827 19.1442L13.5 18.75L14.6827 18.3558C15.3546 18.1318 15.8818 17.6046 16.1058 16.9327L16.5 15.75L16.8942 16.9327C17.1182 17.6046 17.6454 18.1318 18.3173 18.3558L19.5 18.75L18.3173 19.1442C17.6454 19.3682 17.1182 19.8954 16.8942 20.5673Z"/>
      </svg>
    </button>
    <button class="tab" data-go="powers" aria-label="Powers" title="Powers" role="tab" type="button">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5L14.25 2.25L12 10.5H20.25L9.75 21.75L12 13.5H3.75Z"/>
      </svg>
    </button>
    <button class="tab" data-go="gear" aria-label="Gear" title="Gear" role="tab" type="button">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M20.38 3.46 16 2a4 4 0 0 1-8 0L3.62 3.46a2 2 0 0 0-1.34 2.23l.58 3.47a1 1 0 0 0 .99.84H6v10c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V10h2.15a1 1 0 0 0 .99-.84l.58-3.47a2 2 0 0 0-1.34-2.23z"/>
      </svg>
    </button>
    <button class="tab" data-go="story" aria-label="Story" title="Story" role="tab" type="button">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.04168C10.4077 4.61656 8.30506 3.75 6 3.75C4.94809 3.75 3.93834 3.93046 3 4.26212V18.5121C3.93834 18.1805 4.94809 18 6 18C8.30506 18 10.4077 18.8666 12 20.2917M12 6.04168C13.5923 4.61656 15.6949 3.75 18 3.75C19.0519 3.75 20.0617 3.93046 21 4.26212V18.5121C20.0617 18.1805 19.0519 18 18 18C15.6949 18 13.5923 18.8666 12 20.2917M12 6.04168V20.2917"/>
      </svg>
    </button>
  </nav>
</header>

<div class="dm-login-wrapper">
  <button id="dm-login-link" type="button" aria-label="DM Login"></button>
</div>

<main id="main">
  <!-- COMBAT -->
  <fieldset data-tab="combat" class="card">
    <fieldset id="ccShard-player" class="card" hidden>
      <legend>Shard Draw</legend>
      <label for="ccShard-player-count" class="sr-only">Cards</label>
      <div class="grid shard-draw-grid">
        <input id="ccShard-player-count" type="number" inputmode="numeric" min="1" value="1" />
        <button id="ccShard-player-draw" class="btn-sm">Draw</button>
      </div>
      <ol id="ccShard-player-results" class="cc-list"></ol>
    </fieldset>
    <div class="grid grid-2 roll-flip-grid">
      <fieldset class="card">
        <legend>Dice Roll</legend>
        <span class="pill result" id="dice-out" data-placeholder="000"></span>
        <div class="inline">
          <label for="dice-sides" class="sr-only">Sides</label>
          <select id="dice-sides">
            <option value="4">d4</option><option value="6">d6</option><option value="8">d8</option><option value="10">d10</option><option value="12">d12</option><option value="20" selected>d20</option><option value="100">d100</option>
          </select>
          <label for="dice-count" class="sr-only">Count</label>
          <input id="dice-count" type="number" inputmode="numeric" min="1" value="1"/>
          <button id="roll-dice" class="btn-sm">Roll</button>
        </div>
      </fieldset>
      <fieldset class="card">
        <legend>Coin Flip</legend>
        <span class="pill result" id="flip-out" data-placeholder="Heads"></span>
        <div class="inline">
          <button id="flip" class="btn-sm">Flip</button>
        </div>
      </fieldset>
    </div>
    <fieldset id="death-saves" class="card" disabled>
      <legend>Death Saves</legend>
      <div class="death-saves-grid">
        <div class="death-save-tracks">
          <div class="death-save-group">
            <span>Successes</span>
            <label for="death-success-1" class="sr-only">Success 1</label>
            <input type="checkbox" id="death-success-1"/>
            <label for="death-success-2" class="sr-only">Success 2</label>
            <input type="checkbox" id="death-success-2"/>
            <label for="death-success-3" class="sr-only">Success 3</label>
            <input type="checkbox" id="death-success-3"/>
          </div>
          <div class="death-save-group">
            <span>Failures</span>
            <label for="death-fail-1" class="sr-only">Failure 1</label>
            <input type="checkbox" id="death-fail-1"/>
            <label for="death-fail-2" class="sr-only">Failure 2</label>
            <input type="checkbox" id="death-fail-2"/>
            <label for="death-fail-3" class="sr-only">Failure 3</label>
            <input type="checkbox" id="death-fail-3"/>
          </div>
        </div>
        <span id="death-save-out" class="death-save-result" data-placeholder="Roll"></span>
        <div class="death-save-buttons">
          <button id="roll-death-save" class="btn-sm" type="button">Roll</button>
          <button id="death-save-reset" class="btn-sm" type="button">Reset</button>
        </div>
      </div>
    </fieldset>
    <div class="grid grid-1">
      <fieldset class="card hp-field">
        <legend>HP</legend>
          <input id="hp-roll" type="hidden" value="0"/>
          <div class="inline">
            <div class="bar-label">
              <progress id="hp-bar" max="30" value="30"></progress>
              <span id="hp-pill">30/30</span>
            </div>
          </div>
          <div class="inline">
            <label for="hp-temp" class="sr-only">Temp HP</label>
            <input id="hp-temp" type="number" inputmode="numeric" placeholder="Temp HP"/>
            <button id="hp-roll-add" class="btn-sm" type="button">Tier HP</button>
          </div>
          <div class="inline">
            <label for="hp-amt" class="sr-only">Amount</label>
            <input id="hp-amt" type="number" inputmode="numeric" placeholder="Amount"/>
          </div>
          <div class="inline">
            <button id="hp-dmg" class="btn-sm">Damage</button>
            <button id="hp-heal" class="btn-sm">Heal</button>
          </div>
          <div class="inline">
            <button id="hp-full" class="btn-sm">Reset HP</button>
          </div>
      </fieldset>
      <fieldset class="card sp-field">
        <legend>SP</legend>
        <div class="inline">
          <div class="bar-label">
            <progress id="sp-bar" max="5" value="5"></progress>
            <span id="sp-pill">5/5</span>
          </div>
          <label for="sp-temp" class="sr-only">Temp SP</label>
          <input id="sp-temp" type="number" inputmode="numeric" placeholder="Temp SP"/>
        </div>
        <div class="sp-grid">
          <button class="btn-sm" data-sp="-1">-1 SP</button>
          <button class="btn-sm" data-sp="-2">-2 SP</button>
          <button class="btn-sm" data-sp="-3">-3 SP</button>
          <button class="btn-sm" data-sp="-4">-4 SP</button>
          <button class="btn-sm" data-sp="-5">-5 SP</button>
          <button id="sp-full" class="btn-sm">Reset SP</button>
        </div>
        <button id="long-rest" class="btn-sm">Long Rest</button>
        <div class="cap-box">
          <label for="cap-check"><input type="checkbox" id="cap-check"/> Cinematic Action Point <span id="cap-status">Available</span></label>
        </div>
      </fieldset>
    </div>

    <div class="grid grid-1">
      <fieldset class="card">
        <legend>Stats and Effects</legend>
        <div class="stats-grid">
          <div>
            <label for="initiative">Initiative Bonus</label>
            <input id="initiative" type="text" inputmode="numeric" placeholder="auto from DEX + bonuses" readonly/>
          </div>
          <div>
            <label for="speed">Speed (ft)</label>
            <input id="speed" type="number" inputmode="numeric" placeholder="30"/>
          </div>
          <div>
            <label for="pp">Passive Perception</label>
            <input id="pp" type="number" readonly/>
          </div>
          <div>
            <label for="tc">TC</label>
            <input id="tc" type="number" readonly/>
          </div>
        </div>
        <div class="status-effects">
          <h3>Status Effects</h3>
          <div id="statuses" class="grid grid-1"></div>
        </div>
      </fieldset>

      <fieldset id="resonance-points" class="card">
        <legend>Resonance Points (RP)</legend>
        <p>
          Resonance Points are awarded by the GM for truly heroic acts. At <strong>5 RP</strong>, trigger a Heroic Surge for temporary boosts.
        </p>

        <div class="rp-row">
          <label class="rp-label" for="rp-value">Current RP</label>
          <output id="rp-value" aria-live="polite">0</output>
        </div>

        <div class="rp-track" role="group" aria-label="Resonance Points Track">
          <button type="button" id="rp-dec" aria-label="Spend Resonance Point">-</button>
          <button type="button" class="rp-dot" data-rp="1" aria-pressed="false" disabled></button>
          <button type="button" class="rp-dot" data-rp="2" aria-pressed="false" disabled></button>
          <button type="button" class="rp-dot" data-rp="3" aria-pressed="false" disabled></button>
          <button type="button" class="rp-dot" data-rp="4" aria-pressed="false" disabled></button>
          <button type="button" class="rp-dot" data-rp="5" aria-pressed="false" disabled></button>
          <button type="button" id="rp-inc" aria-label="Gain Resonance Point">+</button>
          <div class="rp-bank" aria-live="polite">
            <span class="rp-bank-label">Bank</span>
            <span class="rp-dot rp-bank-dot" data-bank="1" aria-pressed="false"></span>
            <span class="rp-dot rp-bank-dot" data-bank="2" aria-pressed="false"></span>
          </div>
        </div>

        <hr class="rp-divide">

        <div class="rp-surge">
          <div class="rp-surge-status" aria-live="polite">
            <input type="checkbox" id="rp-trigger" disabled aria-label="Activate Heroic Surge"/>
            <strong>Surge Active:</strong> <span id="rp-surge-state">Inactive</span>
          </div>

          <div id="rp-surge-details">
            <h3>Heroic Surge Effects</h3>
            <ul class="rp-list">
              <li>Roleplay checks: +2 to CHA/WIS/INT (leadership, persuasion, interpretation)</li>
              <li>Combat: +1d4 to all attack rolls and saving throws</li>
              <li>SP Flow: +1 SP regenerated per round</li>
              <li>Bonus XP: grant at session end (GM)</li>
            </ul>
            <p class="subtext">Duration: 1 encounter or 10 minutes of narrative time</p>
            <p class="subtext">Aftermath: first save at disadvantage; first round next combat regenerate 1 fewer SP</p>
          </div>

          <div class="rp-surge-controls">
            <button type="button" id="rp-clear-aftermath" disabled aria-label="Aftermath">Aftermath</button>
          </div>

          <div class="rp-tags">
            <span id="rp-tag-active" hidden class="tag">Surge Active</span>
            <span id="rp-tag-aftermath" hidden class="tag warn">Aftermath Pending</span>
          </div>
        </div>
      </fieldset>
    </div>
  </fieldset>

  <!-- ABILITIES -->
  <fieldset data-tab="abilities" class="card">
    <h2 class="card-title">Ability Scores</h2>
    <div id="abil-grid" class="grid ability-grid"></div>
    <fieldset class="card">
      <legend>Proficiency &amp; Power</legend>
      <div class="inline">
        <div style="flex:1">
          <label for="prof-bonus">Proficiency Bonus</label>
          <input id="prof-bonus" type="number" inputmode="numeric" value="2" readonly/>
        </div>
        <div style="flex:1">
          <label for="power-save-ability">Power Save Ability</label>
          <select id="power-save-ability">
            <option value="str">STR</option><option value="dex">DEX</option><option value="con">CON</option>
            <option value="int">INT</option><option value="wis" selected>WIS</option><option value="cha">CHA</option>
          </select>
        </div>
        <div style="flex:1">
          <label for="power-save-dc">Power Save DC</label>
          <input id="power-save-dc" type="number" readonly/>
        </div>
      </div>
    </fieldset>
    <fieldset class="card">
      <legend>Saving Throws</legend>
      <div id="saves" class="grid ability-grid"></div>
    </fieldset>
    <fieldset class="card">
      <legend>Skills</legend>
      <div id="skills" class="grid ability-grid"></div>
    </fieldset>
  </fieldset>

  <!-- POWERS -->
  <fieldset data-tab="powers" class="card">
    <h2 class="card-title">Powers</h2>
    <div class="inline" style="justify-content:flex-end">
      <button id="add-power" style="max-width:180px">Add Power</button>
    </div>
    <div class="grid grid-2" id="powers"></div>

    <div class="inline" style="justify-content:space-between;margin-top:8px">
      <h3 style="margin:0">Signature Moves</h3>
      <button id="add-sig" style="max-width:200px">Add Signature Move</button>
    </div>
    <div class="grid grid-2" id="sigs"></div>
  </fieldset>

  <!-- GEAR -->
  <fieldset data-tab="gear" class="card">
    <h2 class="card-title">Gear</h2>
    <div class="grid grid-2">
      <div class="card">
        <div class="inline" style="justify-content:space-between">
          <h3 style="margin:0">Weapons</h3><button id="add-weapon" class="btn-sm" style="max-width:140px">Add Weapon</button>
        </div>
        <div id="weapons" class="grid grid-1"></div>
      </div>
      <div class="card">
        <div class="inline" style="justify-content:space-between">
          <h3 style="margin:0">Armor &amp; Protection</h3><button id="add-armor" class="btn-sm" style="max-width:160px">Add Armor</button>
        </div>
        <div id="armors" class="grid grid-1"></div>
      </div>
      <div class="card" style="grid-column:1/-1">
        <div class="inline" style="justify-content:space-between">
          <h3 style="margin:0">Gear &amp; Items</h3>
          <div class="inline">
            <button id="add-item" class="btn-sm" style="max-width:140px">Add Item</button>
            <button id="open-catalog" class="btn-sm" style="max-width:160px">Open Gear Catalog</button>
          </div>
        </div>
        <div id="items" class="grid grid-1"></div>
      </div>
    </div>
  </fieldset>

  <!-- STORY -->
  <fieldset data-tab="story" class="card">
    <h2 class="card-title">Character & Story</h2>
    <div class="grid grid-2">
      <div class="card"><label for="superhero">Superhero Identity</label><input id="superhero" placeholder="Vigilante Name"/></div>
      <div class="card"><label for="secret">Secret Identity</label><input id="secret" placeholder="Real name"/></div>
      <div class="card">
        <label for="publicIdentity">Public Identity</label>
        <select id="publicIdentity"><option value="Public">Public</option><option value="Secret" selected>Secret</option></select>
      </div>
      <div class="card">
        <label for="tier">Tier</label>
        <input id="tier" type="text" readonly/>
      </div>
      <div class="card" style="grid-column:1/-1">
        <label for="xp">Experience</label>
        <div class="inline">
          <input id="xp" type="number" inputmode="numeric" value="0" min="0" style="max-width:120px" readonly/>
          <progress id="xp-bar" max="2000" value="0" style="flex:1"></progress>
          <span id="xp-pill" class="pill">0/2000</span>
        </div>
        <div class="inline">
          <label for="xp-amt" class="sr-only">Amount</label>
          <input id="xp-amt" type="number" inputmode="numeric" placeholder="Amount"/>
          <select id="xp-mode" style="max-width:160px">
            <option value="add">Add XP</option>
            <option value="remove">Remove XP</option>
          </select>
          <button id="xp-submit" class="btn-sm">Submit</button>
        </div>
      </div>
      <div class="card">
        <label for="alignment">Alignment</label>
        <select id="alignment">
          <option value="">Select one</option>
          <option>Paragon (Lawful Light)</option>
          <option>Guardian (Neutral Light)</option>
          <option>Vigilante (Chaotic Light)</option>
          <option>Sentinel (Lawful Neutral)</option>
          <option>Outsider (True Neutral)</option>
          <option>Wildcard (Chaotic Neutral)</option>
          <option>Inquisitor (Lawful Shadow)</option>
          <option>Anti-Hero (Neutral Shadow)</option>
          <option>Renegade (Chaotic Shadow)</option>
        </select>
        <ul id="alignment-perks" class="perk-list"></ul>
      </div>
      <div class="card">
        <label for="classification">Classification</label>
        <select id="classification">
          <option value="">Select one</option><option>Mutant</option><option>Enhanced Human</option><option>Magic User</option><option>Alien/Extraterrestrial</option><option>Mystical Being</option>
        </select>
        <ul id="classification-perks" class="perk-list"></ul>
      </div>
      <div class="card">
        <label for="power-style">Primary Power Style</label>
        <select id="power-style">
          <option value="">Select one</option><option>Physical Powerhouse</option><option>Energy Manipulator</option><option>Speedster</option>
          <option>Telekinetic/Psychic</option><option>Illusionist</option><option>Shape-shifter</option><option>Elemental Controller</option>
        </select>
        <ul id="power-style-perks" class="perk-list"></ul>
      </div>
      <div class="card">
        <label for="power-style-2">Secondary Power Style</label>
        <select id="power-style-2">
          <option value="">Select one</option>
          <option>None</option>
          <option>Physical Powerhouse</option><option>Energy Manipulator</option><option>Speedster</option>
          <option>Telekinetic/Psychic</option><option>Illusionist</option><option>Shape-shifter</option><option>Elemental Controller</option>
        </select>
      </div>
      <div class="card">
        <label for="origin">Origin Story</label>
        <select id="origin">
          <option value="">Select one</option>
          <option>The Accident</option>
          <option>The Experiment</option>
          <option>The Legacy</option>
          <option>The Awakening</option>
          <option>The Pact</option>
          <option>The Lost Time</option>
          <option>The Exposure</option>
          <option>The Rebirth</option>
          <option>The Vigil</option>
          <option>The Redemption</option>
        </select>
        <ul id="origin-perks" class="perk-list"></ul>
      </div>
      <div class="card">
        <label>Faction Reputation</label>
          <div class="grid grid-1 faction-rep">
            <div>
              <div class="inline faction-header">
                <span class="pill pill-sm">O.M.N.I.</span>
                <span id="omni-rep-tier" class="pill pill-sm">Neutral</span>
              </div>
              <progress id="omni-rep-bar" max="100" value="0"></progress>
              <p id="omni-rep-perk" class="perk"></p>
              <div class="inline">
                <button id="omni-rep-gain" class="btn-sm">Gain</button>
                <button id="omni-rep-lose" class="btn-sm">Lose</button>
              </div>
              <input type="hidden" id="omni-rep" value="200"/>
            </div>
            <div>
              <div class="inline faction-header">
                <span class="pill pill-sm">P.F.V.</span>
                <span id="pfv-rep-tier" class="pill pill-sm">Neutral</span>
              </div>
              <progress id="pfv-rep-bar" max="100" value="0"></progress>
              <p id="pfv-rep-perk" class="perk"></p>
              <div class="inline">
                <button id="pfv-rep-gain" class="btn-sm">Gain</button>
                <button id="pfv-rep-lose" class="btn-sm">Lose</button>
              </div>
              <input type="hidden" id="pfv-rep" value="200"/>
            </div>
            <div>
              <div class="inline faction-header">
                <span class="pill pill-sm">Cosmic Conclave</span>
                <span id="conclave-rep-tier" class="pill pill-sm">Neutral</span>
              </div>
              <progress id="conclave-rep-bar" max="100" value="0"></progress>
              <p id="conclave-rep-perk" class="perk"></p>
              <div class="inline">
                <button id="conclave-rep-gain" class="btn-sm">Gain</button>
                <button id="conclave-rep-lose" class="btn-sm">Lose</button>
              </div>
              <input type="hidden" id="conclave-rep" value="200"/>
            </div>
            <div>
              <div class="inline faction-header">
                <span class="pill pill-sm">Greyline PMC</span>
                <span id="greyline-rep-tier" class="pill pill-sm">Neutral</span>
              </div>
              <progress id="greyline-rep-bar" max="100" value="0"></progress>
              <p id="greyline-rep-perk" class="perk"></p>
              <div class="inline">
                <button id="greyline-rep-gain" class="btn-sm">Gain</button>
                <button id="greyline-rep-lose" class="btn-sm">Lose</button>
              </div>
              <input type="hidden" id="greyline-rep" value="200"/>
            </div>
          </div>
      </div>

    </div>

    <div class="card">
      <label for="story-notes">Backstory / Notes</label>
      <textarea id="story-notes" rows="6" placeholder="Key events, allies, vulnerabilities, research/training notes, etc."></textarea>
    </div>
      <h3>Character Questions</h3>
    <div class="grid grid-1">
      <div class="card"><label for="q-mask">Who are you behind the mask?</label><textarea id="q-mask" rows="2"></textarea></div>
      <div class="card"><label for="q-justice">What does justice mean to you?</label><textarea id="q-justice" rows="2"></textarea></div>
      <div class="card"><label for="q-fear">What is your biggest fear or unresolved trauma?</label><textarea id="q-fear" rows="2"></textarea></div>
      <div class="card"><label for="q-first-power">What moment first defined your sense of power‚Äîwas it thrilling, terrifying, or tragic?</label><textarea id="q-first-power" rows="2"></textarea></div>
      <div class="card"><label for="q-origin-meaning">What does your Origin Story mean to you now?</label><textarea id="q-origin-meaning" rows="2"></textarea></div>
      <div class="card"><label for="q-before-powers">What was your life like before you had powers or before you remembered having them?</label><textarea id="q-before-powers" rows="2"></textarea></div>
      <div class="card"><label for="q-power-scare">What is one way your powers scare even you?</label><textarea id="q-power-scare" rows="2"></textarea></div>
      <div class="card"><label for="q-signature-move">What is your signature move or ability, and how does it reflect who you are?</label><textarea id="q-signature-move" rows="2"></textarea></div>
      <div class="card"><label for="q-emotional">What happens to your powers when you are emotionally compromised?</label><textarea id="q-emotional" rows="2"></textarea></div>
      <div class="card"><label for="q-no-line">What line will you never cross even if the world burns around you?</label><textarea id="q-no-line" rows="2"></textarea></div>
      <div class="card"><label for="q-alignment-fear">Which Alignment do you identify with, and which do you fear becoming?</label><textarea id="q-alignment-fear" rows="2"></textarea></div>
      <div class="card"><label for="q-opinion">Whose opinion matters more to you‚Äîcivilians, teammates, or your faction superiors? Why?</label><textarea id="q-opinion" rows="2"></textarea></div>
      <div class="card"><label for="q-drive">What drives you to fight‚Äîjustice, guilt, revenge, legacy, redemption, or something else?</label><textarea id="q-drive" rows="2"></textarea></div>
      <div class="card"><label for="q-walk-away">What would make you walk away from this life for good?</label><textarea id="q-walk-away" rows="2"></textarea></div>
      <div class="card"><label for="q-secret">What is one major secret you are keeping from the rest of the team?</label><textarea id="q-secret" rows="2"></textarea></div>
      <div class="card"><label for="q-vulnerable">What situation leaves you the most vulnerable‚Äîphysically, emotionally, or strategically?</label><textarea id="q-vulnerable" rows="2"></textarea></div>
      <div class="card"><label for="q-admire">Which teammate do you admire the most and what do they have that you lack?</label><textarea id="q-admire" rows="2"></textarea></div>
      <div class="card"><label for="q-if-lost">If you lost your powers tomorrow, who would you still be?</label><textarea id="q-if-lost" rows="2"></textarea></div>
    </div>
  </fieldset>


</main>


<div class="overlay hidden" id="modal-load-list" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" tabindex="-1">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3>All Characters</h3>
    <div class="load-layout">
      <div id="char-list" class="catalog"></div>
      <div class="load-actions">
        <button id="recover-save" class="btn-sm" type="button">Recover Save</button>
        <button id="create-character" class="btn-sm" type="button">Create New</button>
        <button id="save-current" class="btn-sm" type="button">Save</button>
      </div>
    </div>
  </div>
</div>

<div class="overlay hidden" id="modal-recover-char" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" tabindex="-1">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3>Select Character</h3>
    <div id="recover-char-list" class="catalog"></div>
  </div>
</div>

<div class="overlay hidden" id="modal-recover-list" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" tabindex="-1">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3>Recover Backup</h3>
    <div id="recover-list" class="catalog"></div>
  </div>
</div>

<div class="overlay hidden" id="modal-load" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" tabindex="-1">
    <p id="load-confirm-text"></p>
    <div class="actions">
      <button id="load-cancel" class="btn-sm">Cancel</button>
      <button id="load-accept" class="btn-sm">Accept</button>
    </div>
  </div>
</div>

<!-- WELCOME MODAL -->
<div class="overlay hidden" id="modal-welcome" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" tabindex="-1">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3>Welcome to the Tracker</h3>
    <p>Use the tabs to navigate your sheet. Changes save automatically and work offline.</p>
    <div class="actions">
      <button id="welcome-ok" type="button">Get Started</button>
    </div>
  </div>
</div>

<!-- HELP MODAL -->
<div class="overlay hidden" id="modal-help" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" tabindex="-1">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3>How to Use the Tracker</h3>
    <ul class="feature-list">
      <li><b>Theme</b> Tap the header or logo to cycle between light, high-contrast, and dark modes.</li>
      <li><b>Main menu</b> Access Load, Help, and Save from the menu.</li>
      <li><b>Tab navigation</b> Use the Combat, Abilities, Powers, Gear, and Story tabs to move between sections.</li>
      <li><b>Combat tools</b> Update HP/SP, mark death saves, adjust defenses, and make quick rolls or flips.</li>
      <li><b>Abilities management</b> Edit ability scores and proficiency bonuses on the Abilities tab.</li>
      <li><b>Powers management</b> Record powers or spells and track their uses in the Powers tab.</li>
      <li><b>Gear</b> Track equipment on the Gear tab.</li>
      <li><b>Story notes</b> Keep background details, quests, and other notes on the Story tab.</li>
      <li><b>Saving</b> Use Save to store your progress locally.</li>
    </ul>
    <h4>Frequently Asked Questions</h4>
    <ul class="qa-list">
      <li><b>Can I use the tracker offline?</b> Yes. The app stores data in your browser so it works offline.</li>
      <li><b>How do I change the theme?</b> Tap the header or logo to switch themes.</li>
      <li><b>Where do I adjust my HP or SP?</b> Visit the Combat tab and tap the current values to edit them.</li>
      <li><b>How do I roll a die or flip a coin?</b> Use the quick tools on the Combat tab.</li>
      <li><b>How can I manage my equipment?</b> Use the Gear tab to add and manage items.</li>
      <li><b>How do I save my character?</b> Choose <i>Save</i> from the menu to manually save your progress.</li>
    </ul>
  </div>
</div>

<!-- INITIATIVE MODAL -->
<div class="overlay hidden" id="modal-enc" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" tabindex="-1">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3>Encounter Tracker</h3>
    <fieldset class="inline">
      <legend class="sr-only">Add Combatant</legend>
      <label for="enc-name" class="sr-only">Name</label>
      <input id="enc-name" placeholder="Name"/>
      <label for="enc-init" class="sr-only">Init</label>
      <input id="enc-init" type="number" inputmode="numeric" placeholder="Init"/>
      <button id="enc-add" class="btn-sm">Add</button>
    </fieldset>
    <div id="enc-list" class="catalog" style="margin-top:8px"></div>
    <div class="actions">
      <button id="enc-prev" class="btn-sm">Prev Turn</button>
      <button id="enc-next" class="btn-sm">Next Turn</button>
      <button id="enc-reset" class="btn-sm">Reset</button>
    </div>
  </div>
</div>

<div class="overlay hidden" id="modal-hp-roll" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" tabindex="-1">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3>Tier HP</h3>
    <label for="hp-roll-input" class="sr-only">Tier HP Bonus</label>
    <input id="hp-roll-input" type="number" inputmode="numeric" placeholder="Tier HP Bonus"/>
    <ul id="hp-roll-list"></ul>
    <div class="actions">
      <button id="hp-roll-save" class="btn-sm">Add</button>
      <button class="btn-sm" data-close>Cancel</button>
    </div>
  </div>
</div>


<!-- LOG MODAL -->
<div class="overlay hidden" id="modal-log" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" tabindex="-1">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3>Recent Log</h3>
    <div class="grid grid-2">
      <div><h4 style="margin:0">Dice</h4><div id="log-dice" class="catalog"></div></div>
      <div><h4 style="margin:0">Coins</h4><div id="log-coin" class="catalog"></div></div>
    </div>
    <div class="actions"><button id="log-full" class="btn-sm">Full Log</button><button class="btn-sm" data-close>Close</button></div>
  </div>
</div>


<div class="overlay hidden" id="modal-campaign" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" tabindex="-1">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3>Campaign Log</h3>
    <label for="campaign-entry" class="sr-only">Campaign Log Entry</label>
    <textarea id="campaign-entry" rows="2" placeholder="Session notes..."></textarea>
    <div class="actions">
      <button id="campaign-add" class="btn-sm" style="max-width:140px">Add Entry</button>
    </div>
    <div id="campaign-log" class="catalog"></div>
    <div class="actions"><button class="btn-sm" data-close>Close</button></div>
  </div>
</div>

<div class="overlay hidden" id="modal-log-full" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" tabindex="-1">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3>Full Log</h3>
    <div class="grid grid-2">
      <div><h4 style="margin:0">Dice</h4><div id="full-log-dice" class="catalog"></div></div>
      <div><h4 style="margin:0">Coins</h4><div id="full-log-coin" class="catalog"></div></div>
    </div>
    <div class="actions"><button class="btn-sm" data-close>Close</button></div>
  </div>
</div>

<div class="overlay hidden" id="modal-faction-perk" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-label="Faction Perk" tabindex="-1">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3>Faction Perk</h3>
    <ul id="modal-faction-perk-list" class="perk-list"></ul>
  </div>
</div>


<!-- GEAR CATALOG -->
<div class="overlay hidden" id="modal-catalog" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" tabindex="-1">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3>Gear Catalog</h3>
    <fieldset class="inline" style="margin:6px 0">
      <legend class="sr-only">Filters</legend>
      <label for="catalog-filter-style" class="sr-only">Style</label>
      <select id="catalog-filter-style" style="max-width:260px"></select>
      <label for="catalog-filter-type" class="sr-only">Type</label>
      <select id="catalog-filter-type" style="max-width:180px"><option value="">All Types</option><option>Armor</option><option>Shield</option><option>Utility</option></select>
      <label for="catalog-filter-rarity" class="sr-only">Rarity</label>
      <select id="catalog-filter-rarity" style="max-width:160px"><option value="">All Rarities</option><option>Common</option><option>Uncommon</option><option>Rare</option><option>Elite</option><option>Legendary</option></select>
      <label for="catalog-search" class="sr-only">Search</label>
      <input id="catalog-search" placeholder="Search..."/>
    </fieldset>
    <div id="catalog-list" class="catalog"></div>
</div>
</div>

<!-- RULES -->
<div class="overlay hidden" id="modal-rules" aria-hidden="true">
  <div class="modal modal-rules" role="dialog" aria-modal="true" aria-label="Rules Help" tabindex="-1">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <pre id="rules-text"></pre>
  </div>
</div>

<div class="overlay hidden" id="modal-shard-resolve" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" tabindex="-1">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <label class="cc-switch"><input id="dm-shard-toggle" type="checkbox"><span>Allow Shards</span></label>
    <h3 id="shard-resolve-title">Resolve Shard</h3>
    <div class="cc-tabs">
      <nav class="cc-tabs__nav">
        <button data-tab="card" class="active">Card</button>
        <button data-tab="npcs">NPCs</button>
        <button data-tab="tips">DM Tips</button>
      </nav>
      <article class="cc-tabs__pane active" id="shard-resolve-card"></article>
      <article class="cc-tabs__pane" id="shard-resolve-npcs"></article>
      <article class="cc-tabs__pane" id="shard-resolve-tips"></article>
    </div>
    <div class="actions">
      <button id="shard-resolve-addnpc" class="btn-sm" hidden>Add NPC as Character</button>
      <button id="shard-resolve-complete" class="btn-sm">Mark Resolved</button>
      <button id="shard-resolve-reset" class="btn-sm">Reset Shards</button>
    </div>
  </div>
</div>

<div class="overlay hidden" id="modal-shard-reset" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-label="Reset Shards" tabindex="-1">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3>Reset Shards</h3>
    <p>Shuffle all plates back into the deck and allow new draws?</p>
    <div class="actions">
      <button id="shard-reset-confirm" class="btn-sm">Reset</button>
      <button class="btn-sm" data-close>Cancel</button>
    </div>
</div>
</div>

<div class="overlay hidden" id="modal-shard-reveal" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" tabindex="-1">
    <h3 id="shard-reveal-name">Shard Drawn</h3>
    <p id="shard-reveal-visual"></p>
    <div class="actions">
      <button id="shard-reveal-next" class="btn-sm">Close</button>
    </div>
  </div>
</div>

<!-- Shard of Many Fates -->
<!-- Shard of Many Fates ‚Ä¢ Catalyst Core Add-on -->
<section id="cc-shard" class="cc-deck hidden">
      <header class="cc-deck__header">
        <h2>Shard of Many Fates</h2>
        <div class="cc-deck__header-controls">
          <button id="ccShard-showAll" class="cc-btn cc-btn--ghost">Card List</button>
          <button id="ccShard-close" class="cc-btn cc-btn--ghost">Close</button>
        </div>
      </header>
      <div class="cc-deck__main">
        <div class="cc-deck__card">
          <div id="ccShard-flash" class="cc-deck__flash"></div>
          <div class="cc-deck__cardFront">
            <div class="cc-deck__sigil">Ready</div>
            <h3 id="ccShard-cardName">No plate drawn</h3>
            <p id="ccShard-cardVisual" class="muted">Draw to reveal a fate.</p>

            <div class="cc-tabs">
              <nav class="cc-tabs__nav">
                <button data-tab="effect" class="active">Effect</button>
                <button data-tab="hooks">GM Hooks</button>
                <button data-tab="resolution">Resolution</button>
                <button data-tab="enemy">Enemy</button>
                <button data-tab="rewards">Rewards</button>
              </nav>
              <article class="cc-tabs__pane active" id="ccShard-tab-effect"></article>
              <article class="cc-tabs__pane" id="ccShard-tab-hooks"></article>
              <article class="cc-tabs__pane" id="ccShard-tab-resolution"></article>
              <article class="cc-tabs__pane" id="ccShard-tab-enemy"></article>
              <article class="cc-tabs__pane" id="ccShard-tab-rewards"></article>
            </div>

            <div class="cc-deck__actions">
              <button id="ccShard-capCancel" class="cc-btn cc-btn--danger" disabled>Use CAP to cancel</button>
              <button id="ccShard-complete" class="cc-btn cc-btn--primary" disabled>Resolve Plate</button>
            </div>
          </div>
        </div>

        <aside class="cc-deck__sidebar">
          <h4>Draw Log</h4>
          <ol id="ccShard-log" class="cc-list"></ol>

          <h4>Stat Blocks</h4>
          <select id="ccShard-statSelect">
            <option value="">Select stat block</option>
            <option value="H1">Herald of Morvox, Echo Warden (H1)</option>
            <option value="G1">Greyline Assault Cell (G1)</option>
            <option value="C1">Conclave Trial Agent, Blade of Accession (C1)</option>
            <option value="E1">Echo Operative, Tier 3 Ally (E1)</option>
            <option value="B1">Betrayer Template (B1)</option>
          </select>
          <button id="ccShard-openNPC" class="cc-btn cc-btn--ghost" disabled>Open NPC Sheet</button>
          <pre id="ccShard-statView" class="cc-code"></pre>
        </aside>
      </div>
    </section>

    <div id="ccShard-cardList" class="cc-cardList hidden">
      <div class="cc-cardList__body">
        <button id="ccShard-cardList-close" class="cc-btn cc-btn--ghost">Close</button>
        <ol id="ccShard-cardList-ol" class="cc-list"></ol>
      </div>
    </div>

    <div id="ccShard-npcModal" class="cc-npcModal hidden">
      <div class="cc-npcModal__inner">
        <h3 id="ccShard-npcName"></h3>
        <div class="cc-npcStats">
          <label>HP <input id="ccShard-npcHP" type="number" min="0"></label>
          <label>SP <input id="ccShard-npcSP" type="number" min="0"></label>
        </div>
        <div id="ccShard-npcActions" class="cc-npcModal__actions"></div>
        <pre id="ccShard-npcLog" class="cc-code"></pre>
        <button id="ccShard-npcClose" class="cc-btn cc-btn--ghost">Close</button>
      </div>
    </div>


  <footer>
  <p>When the whole world tells you to move, it's your job to plant yourself like a tree by the river of truth and tell the whole world - no, YOU move.</p>
  <p>Product of XoVrom industries ¬Æ 2025</p>
</footer>
<button id="dm-login" class="dm-login-btn" aria-label="DM Tools" hidden></button>
<div id="down-animation" aria-hidden="true" hidden>‚ö†Ô∏è</div>
<div id="death-animation" aria-hidden="true" hidden>üíÄ</div>
<div id="damage-animation" aria-hidden="true" hidden></div>
<div id="heal-animation" aria-hidden="true" hidden></div>
<div id="save-animation" aria-hidden="true" hidden>üíæ</div>
<div id="coin-animation" aria-hidden="true" hidden></div>
<div id="sp-animation" aria-hidden="true" hidden></div>
<div id="load-animation" aria-hidden="true" hidden>üìÇ</div>
<div class="toast" id="dm-toast" role="dialog"></div>
<div class="toast" id="toast" role="status" aria-live="polite"></div>
<script type="module" src="scripts/main.js"></script>
<script type="module" src="scripts/dm.js"></script>
<script src="shard-of-many-fates.js"></script>

</body>
</html>
