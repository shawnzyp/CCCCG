<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"/>
<meta name="description" content="Mobile-optimized character tracker for the Catalyst Core RPG."/>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link rel="icon" type="image/png" sizes="1024x1024" href="images/LOGO.PNG"/>
<link rel="apple-touch-icon" sizes="180x180" href="images/LOGO.PNG"/>
<link rel="shortcut icon" type="image/png" sizes="1024x1024" href="images/LOGO.PNG"/>
<meta property="og:image" content="images/LOGO.PNG"/>
<meta name="twitter:image" content="images/LOGO.PNG"/>
<meta name="theme-color" content="#0e1117"/>
<meta name="color-scheme" content="dark light"/>
<title>Catalyst Core</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet"/>
<link rel="stylesheet" href="styles/main.css"/>
</head>
<body class="launching">
<noscript>This app requires JavaScript to run properly.</noscript>

<div id="launch-animation" role="presentation" aria-hidden="true">
  <video
    autoplay
    muted
    playsinline
    preload="auto"
    webkit-playsinline
  >
    <source src="media/launch-animation.webm" type="video/webm"/>
    <source src="media/launch-animation.mp4" type="video/mp4"/>
    <source src="images/b02fb7b3-095b-4e40-9e4e-20fb5ee3b4b9.mp4" type="video/mp4"/>
    Sorry, your browser does not support the launch animation video.
  </video>
  <button type="button" class="launch-skip" data-skip-launch>Skip</button>
</div>
<script>
  (function(){
    const DEFAULT_FALLBACK = 12000;
    const MIN_VISIBLE = 1800;
    const body = document.body;
    const launchEl = document.getElementById('launch-animation');
    const video = launchEl ? launchEl.querySelector('video') : null;
    if(!body || !launchEl){
      return;
    }

    let skipLaunch = false;
    try {
      if (sessionStorage.getItem('cc:skip-launch') === '1') {
        sessionStorage.removeItem('cc:skip-launch');
        skipLaunch = true;
      }
    } catch (err) {
      // ignore storage errors
    }

    if (skipLaunch) {
      body.classList.remove('launching');
      launchEl.setAttribute('data-hidden', 'true');
      requestAnimationFrame(() => {
        if (launchEl.parentNode) {
          launchEl.parentNode.removeChild(launchEl);
        }
      });
      return;
    }

    let fallbackTimer = null;
    const clearFallback = () => {
      if(fallbackTimer){
        window.clearTimeout(fallbackTimer);
        fallbackTimer = null;
      }
    };

    const hideLaunch = () => {
      if(!body.classList.contains('launching')){
        return;
      }
      clearFallback();
      body.classList.remove('launching');
      launchEl.setAttribute('data-hidden', 'true');
      launchEl.addEventListener('transitionend', () => {
        if(launchEl.parentNode){
          launchEl.parentNode.removeChild(launchEl);
        }
      }, { once: true });
      window.setTimeout(() => {
        if(launchEl.parentNode){
          launchEl.parentNode.removeChild(launchEl);
        }
      }, 800);
    };

    const scheduleFallback = (delay = DEFAULT_FALLBACK) => {
      clearFallback();
      const timeout = Math.max(delay, MIN_VISIBLE);
      fallbackTimer = window.setTimeout(() => {
        if(body.classList.contains('launching')){
          hideLaunch();
        }
      }, timeout);
    };

    if(video){
      const ensureAttributes = () => {
        try { video.setAttribute('playsinline', ''); } catch (err) {}
        try { video.setAttribute('webkit-playsinline', ''); } catch (err) {}
        try {
          if(!video.hasAttribute('muted')){
            video.setAttribute('muted', '');
          }
          video.muted = true;
        } catch (err) {}
      };
      const attemptPlay = () => {
        ensureAttributes();
        if(typeof video.play === 'function'){
          const playAttempt = video.play();
          if(playAttempt && typeof playAttempt.catch === 'function'){
            playAttempt.catch(() => {});
          }
        }
      };
      const handleReady = () => {
        attemptPlay();
        const durationMs = Number.isFinite(video.duration) && video.duration > 0
          ? (video.duration * 1000) + 500
          : DEFAULT_FALLBACK;
        scheduleFallback(durationMs);
      };
      ensureAttributes();
      video.addEventListener('ended', hideLaunch, { once: true });
      ['error','abort','stalled','suspend'].forEach(evt => {
        video.addEventListener(evt, () => scheduleFallback(MIN_VISIBLE), { once: true });
      });
      video.addEventListener('loadeddata', ensureAttributes, { once: true });
      if(video.readyState >= 1){
        handleReady();
      } else {
        video.addEventListener('loadedmetadata', handleReady, { once: true });
        scheduleFallback(DEFAULT_FALLBACK);
      }
    }

    if(!video){
      if(document.readyState === 'complete'){
        scheduleFallback();
      } else {
        window.addEventListener('load', () => scheduleFallback(), { once: true });
      }
    }
  })();
</script>

<div class="app-shell" data-launch-shell>
<a href="#main" class="skip-link">Skip to main content</a>


<header>
  <div class="top">
    <span class="tabs-title"><img src="images/LOGO.PNG" alt="Catalyst Core logo" class="logo"/>Catalyst Core</span>
    <div class="dropdown">
      <button id="btn-menu" class="icon" aria-label="Menu" title="Menu" aria-haspopup="true" aria-expanded="false" aria-controls="menu-actions" type="button">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 6.75h15m-15 5.25h15m-15 5.25h15"/>
        </svg>
      </button>
      <div id="menu-actions" class="menu" hidden>
        <button id="btn-load" class="btn-sm">Load / Save</button>
        <button id="btn-view-mode" class="btn-sm" type="button" aria-pressed="false" title="Switch to View Mode">View Mode</button>
        <button id="btn-enc" class="btn-sm" aria-label="Encounter / Initiative" title="Encounter / Initiative">Encounter / Initiative</button>
        <button id="btn-log" class="btn-sm">Action Log</button>
        <button id="btn-campaign" class="btn-sm">Campaign Log</button>
        <button id="btn-rules" class="btn-sm">Rules</button>
        <button id="btn-help" class="btn-sm">Help</button>
      </div>
    </div>
  </div>
  <nav class="tabs" role="tablist" aria-label="Primary">
    <button class="tab active" data-go="combat" aria-label="Combat" title="Combat" role="tab" aria-current="page" type="button">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <polyline stroke-linecap="round" stroke-linejoin="round" points="14.5 17.5 3 6 3 3 6 3 17.5 14.5"/>
        <line stroke-linecap="round" stroke-linejoin="round" x1="13" y1="19" x2="19" y2="13"/>
        <line stroke-linecap="round" stroke-linejoin="round" x1="16" y1="16" x2="20" y2="20"/>
        <line stroke-linecap="round" stroke-linejoin="round" x1="19" y1="21" x2="21" y2="19"/>
      </svg>
    </button>
    <button class="tab" data-go="abilities" aria-label="Abilities" title="Abilities" role="tab" type="button">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9.8132 15.9038L9 18.75L8.1868 15.9038C7.75968 14.4089 6.59112 13.2403 5.09619 12.8132L2.25 12L5.09619 11.1868C6.59113 10.7597 7.75968 9.59112 8.1868 8.09619L9 5.25L9.8132 8.09619C10.2403 9.59113 11.4089 10.7597 12.9038 11.1868L15.75 12L12.9038 12.8132C11.4089 13.2403 10.2403 14.4089 9.8132 15.9038Z"/>
        <path stroke-linecap="round" stroke-linejoin="round" d="M18.2589 8.71454L18 9.75L17.7411 8.71454C17.4388 7.50533 16.4947 6.56117 15.2855 6.25887L14.25 6L15.2855 5.74113C16.4947 5.43883 17.4388 4.49467 17.7411 3.28546L18 2.25L18.2589 3.28546C18.5612 4.49467 19.5053 5.43883 20.7145 5.74113L21.75 6L20.7145 6.25887C19.5053 6.56117 18.5612 7.50533 18.2589 8.71454Z"/>
        <path stroke-linecap="round" stroke-linejoin="round" d="M16.8942 20.5673L16.5 21.75L16.1058 20.5673C15.8818 19.8954 15.3546 19.3682 14.6827 19.1442L13.5 18.75L14.6827 18.3558C15.3546 18.1318 15.8818 17.6046 16.1058 16.9327L16.5 15.75L16.8942 16.9327C17.1182 17.6046 17.6454 18.1318 18.3173 18.3558L19.5 18.75L18.3173 19.1442C17.6454 19.3682 17.1182 19.8954 16.8942 20.5673Z"/>
      </svg>
    </button>
    <button class="tab" data-go="powers" aria-label="Powers" title="Powers" role="tab" type="button">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5L14.25 2.25L12 10.5H20.25L9.75 21.75L12 13.5H3.75Z"/>
      </svg>
    </button>
    <button class="tab" data-go="gear" aria-label="Gear" title="Gear" role="tab" type="button">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M20.38 3.46 16 2a4 4 0 0 1-8 0L3.62 3.46a2 2 0 0 0-1.34 2.23l.58 3.47a1 1 0 0 0 .99.84H6v10c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V10h2.15a1 1 0 0 0 .99-.84l.58-3.47a2 2 0 0 0-1.34-2.23z"/>
      </svg>
    </button>
    <button class="tab" data-go="story" aria-label="Story" title="Story" role="tab" type="button">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.04168C10.4077 4.61656 8.30506 3.75 6 3.75C4.94809 3.75 3.93834 3.93046 3 4.26212V18.5121C3.93834 18.1805 4.94809 18 6 18C8.30506 18 10.4077 18.8666 12 20.2917M12 6.04168C13.5923 4.61656 15.6949 3.75 18 3.75C19.0519 3.75 20.0617 3.93046 21 4.26212V18.5121C20.0617 18.1805 19.0519 18 18 18C15.6949 18 13.5923 18.8666 12 20.2917M12 6.04168V20.2917"/>
      </svg>
    </button>
  </nav>
  <div class="news-ticker" role="status" aria-live="polite" aria-labelledby="news-ticker-label">
    <div class="news-ticker__inner">
      <span class="news-ticker__label" id="news-ticker-label">
        <span class="news-ticker__logo" aria-hidden="true" role="presentation"></span>
        <span class="sr-only">O.M.N.I tip ticker</span>
      </span>
      <div class="news-ticker__track" data-fun-ticker-track>
        <span class="news-ticker__text" data-fun-ticker-text>Loading fun tips…</span>
      </div>
    </div>
  </div>
  <div class="news-ticker news-ticker--m24n" role="status" aria-live="polite" aria-labelledby="m24n-ticker-label">
    <div class="news-ticker__inner">
      <span class="news-ticker__label news-ticker__label--m24n" id="m24n-ticker-label">
        <span class="news-ticker__logo news-ticker__logo--m24n" aria-hidden="true">MN24/7:</span>
        <span class="news-ticker__badge news-ticker__badge--live" aria-hidden="true">LIVE</span>
        <span class="sr-only">MN24/7 breaking news ticker</span>
      </span>
      <div class="news-ticker__track news-ticker__track--m24n" data-m24n-ticker-track>
        <span class="news-ticker__text news-ticker__text--m24n" data-m24n-ticker-text>Loading MN24/7 feed…</span>
      </div>
    </div>
  </div>
</header>

<main id="main">
  <!-- COMBAT -->
  <fieldset data-tab="combat" class="card">
    <section id="somf-min" class="somf-card" hidden>
      <h3 class="somf-title">The Shards of Many Fates</h3>
      <div class="somf-row">
        <label for="somf-min-count" class="somf-label">Shards</label>
        <input id="somf-min-count" type="number" inputmode="numeric" pattern="[0-9]*" min="1" max="22" value="1" class="somf-input" data-view-allow>
        <button id="somf-min-draw" type="button" class="somf-btn somf-primary">Draw Shards</button>
      </div>
    </section>

    <h2 class="card-title">Combat</h2>

    <div class="grid grid-2 roll-flip-grid">
      <fieldset class="card">
        <legend data-animate-title>Dice Roll</legend>
        <span class="pill result" id="dice-out" data-placeholder="000"></span>
        <div class="inline">
          <label for="dice-sides" class="sr-only">Sides</label>
          <select id="dice-sides" data-view-allow>
            <option value="4">d4</option><option value="6">d6</option><option value="8">d8</option><option value="10">d10</option><option value="12">d12</option><option value="20" selected>d20</option><option value="100">d100</option>
          </select>
          <label for="dice-count" class="sr-only">Count</label>
          <input id="dice-count" data-view-allow type="number" inputmode="numeric" pattern="[0-9]*" min="1" value="1"/>
          <button id="roll-dice" class="btn-sm">Roll</button>
        </div>
      </fieldset>
      <fieldset class="card">
        <legend data-animate-title>Coin Flip</legend>
        <span class="pill result" id="flip-out" data-placeholder="Heads"></span>
        <div class="inline">
          <button id="flip" class="btn-sm">Flip</button>
        </div>
      </fieldset>
    </div>
    <fieldset id="death-saves" class="card" disabled>
      <legend data-animate-title>Death Saves</legend>
      <div class="death-saves-grid">
        <div class="death-save-tracks">
          <div class="death-save-group">
            <span>Successes</span>
            <label for="death-success-1" class="sr-only">Success 1</label>
            <input type="checkbox" id="death-success-1"/>
            <label for="death-success-2" class="sr-only">Success 2</label>
            <input type="checkbox" id="death-success-2"/>
            <label for="death-success-3" class="sr-only">Success 3</label>
            <input type="checkbox" id="death-success-3"/>
          </div>
          <div class="death-save-group">
            <span>Failures</span>
            <label for="death-fail-1" class="sr-only">Failure 1</label>
            <input type="checkbox" id="death-fail-1"/>
            <label for="death-fail-2" class="sr-only">Failure 2</label>
            <input type="checkbox" id="death-fail-2"/>
            <label for="death-fail-3" class="sr-only">Failure 3</label>
            <input type="checkbox" id="death-fail-3"/>
          </div>
        </div>
        <span id="death-save-out" class="death-save-result" data-placeholder="Roll"></span>
        <div class="death-save-buttons">
          <button id="roll-death-save" class="btn-sm" type="button">Roll</button>
          <button id="death-save-reset" class="btn-sm" type="button">Reset</button>
        </div>
      </div>
    </fieldset>
    <div class="grid grid-1">
      <fieldset class="card hp-field">
        <legend data-animate-title>HP</legend>
          <input id="hp-roll" type="hidden" value="0"/>
          <div class="inline">
            <div class="bar-label">
              <progress id="hp-bar" max="30" value="30"></progress>
              <span id="hp-pill">30/30</span>
            </div>
          </div>
          <div class="inline">
            <label for="hp-temp" class="sr-only">Temp HP</label>
            <input id="hp-temp" data-view-allow type="number" inputmode="numeric" pattern="[0-9]*" placeholder="Temp HP"/>
            <button id="hp-roll-add" class="btn-sm" type="button">Tier HP</button>
          </div>
          <div class="inline">
            <label for="hp-amt" class="sr-only">Amount</label>
            <input id="hp-amt" data-view-allow type="number" inputmode="numeric" pattern="[0-9]*" placeholder="Amount"/>
          </div>
          <div class="inline">
            <button id="hp-dmg" class="btn-sm">Damage</button>
            <button id="hp-heal" class="btn-sm">Heal</button>
          </div>
          <div class="inline">
            <button id="hp-full" class="btn-sm">Reset HP</button>
          </div>
      </fieldset>
      <fieldset class="card sp-field">
        <legend data-animate-title>SP</legend>
        <div class="inline">
          <div class="bar-label">
            <progress id="sp-bar" max="5" value="5"></progress>
            <span id="sp-pill">5/5</span>
          </div>
          <label for="sp-temp" class="sr-only">Temp SP</label>
          <input id="sp-temp" data-view-allow type="number" inputmode="numeric" pattern="[0-9]*" placeholder="Temp SP"/>
        </div>
        <div class="sp-grid">
          <button class="btn-sm" data-sp="-1">-1 SP</button>
          <button class="btn-sm" data-sp="-2">-2 SP</button>
          <button class="btn-sm" data-sp="-3">-3 SP</button>
          <button class="btn-sm" data-sp="-4">-4 SP</button>
          <button class="btn-sm" data-sp="-5">-5 SP</button>
          <button id="sp-full" class="btn-sm">Reset SP</button>
        </div>
        <button id="long-rest" class="btn-sm">Long Rest</button>
        <div class="cap-box">
          <label for="cap-check">
            <input type="checkbox" id="cap-check"/>
            <span class="cap-label-text" data-animate-title>Cinematic Action Point</span>
            <span id="cap-status">Available</span>
          </label>
        </div>
      </fieldset>
    </div>

    <div class="grid grid-1">
      <fieldset class="card">
        <legend data-animate-title>Stats and Effects</legend>
        <div class="stats-grid">
          <div>
            <label for="initiative">Initiative Bonus</label>
            <input id="initiative" type="text" inputmode="numeric" pattern="[0-9]*" placeholder="auto from DEX + bonuses" readonly/>
          </div>
          <div>
            <label for="speed">Speed (ft)</label>
            <input id="speed" type="number" inputmode="numeric" pattern="[0-9]*" placeholder="30"/>
          </div>
          <div>
            <label for="pp">Passive Perception</label>
            <input id="pp" type="number" inputmode="numeric" pattern="[0-9]*" readonly/>
          </div>
          <div>
            <label for="tc">TC</label>
            <input id="tc" type="number" inputmode="numeric" pattern="[0-9]*" readonly/>
          </div>
        </div>
        <div class="status-effects">
          <h3>Status Effects</h3>
          <div id="statuses" class="grid grid-1"></div>
        </div>
      </fieldset>

      <fieldset id="resonance-points" class="card">
        <legend data-animate-title>Resonance Points (RP)</legend>
        <p>
          Resonance Points are awarded by the GM for truly heroic acts. At <strong>5 RP</strong>, trigger a Heroic Surge for temporary boosts.
        </p>

        <div class="rp-row">
          <label class="rp-label" for="rp-value">Current RP</label>
          <output id="rp-value" aria-live="polite">0</output>
        </div>

        <div class="rp-track" role="group" aria-label="Resonance Points Track">
          <button type="button" id="rp-dec" aria-label="Spend Resonance Point">-</button>
          <button type="button" class="rp-dot" data-rp="1" aria-pressed="false" disabled></button>
          <button type="button" class="rp-dot" data-rp="2" aria-pressed="false" disabled></button>
          <button type="button" class="rp-dot" data-rp="3" aria-pressed="false" disabled></button>
          <button type="button" class="rp-dot" data-rp="4" aria-pressed="false" disabled></button>
          <button type="button" class="rp-dot" data-rp="5" aria-pressed="false" disabled></button>
          <button type="button" id="rp-inc" aria-label="Gain Resonance Point">+</button>
          <div class="rp-bank" aria-live="polite">
            <span class="rp-bank-label">Bank</span>
            <span class="rp-dot rp-bank-dot" data-bank="1" aria-pressed="false"></span>
            <span class="rp-dot rp-bank-dot" data-bank="2" aria-pressed="false"></span>
          </div>
        </div>

        <hr class="rp-divide">

        <div class="rp-surge">
          <div class="rp-surge-status" aria-live="polite">
            <input type="checkbox" id="rp-trigger" disabled aria-label="Activate Heroic Surge"/>
            <strong>Surge Active:</strong> <span id="rp-surge-state">Inactive</span>
          </div>

          <div id="rp-surge-details">
            <h3>Heroic Surge Effects</h3>
            <ul class="rp-list">
              <li>Roleplay checks: +2 to CHA/WIS/INT (leadership, persuasion, interpretation)</li>
              <li>Combat: +1d4 to all attack rolls and saving throws</li>
              <li>SP Flow: +1 SP regenerated per round</li>
              <li>Bonus XP: grant at session end (GM)</li>
            </ul>
            <p class="subtext">Duration: 1 encounter or 10 minutes of narrative time</p>
            <p class="subtext">Aftermath: first save at disadvantage; first round next combat regenerate 1 fewer SP</p>
          </div>

          <div class="rp-surge-controls">
            <button type="button" id="rp-clear-aftermath" disabled aria-label="Aftermath">Aftermath</button>
          </div>

          <div class="rp-tags">
            <span id="rp-tag-active" hidden class="tag">Surge Active</span>
            <span id="rp-tag-aftermath" hidden class="tag warn">Aftermath Pending</span>
          </div>
        </div>
      </fieldset>
    </div>
  </fieldset>

  <!-- ABILITIES -->
  <fieldset data-tab="abilities" class="card">
    <h2 class="card-title">Ability Scores</h2>
    <div id="abil-grid" class="grid ability-grid"></div>
    <fieldset class="card">
      <legend data-animate-title>Proficiency and Power</legend>
      <div class="inline">
        <div style="flex:1">
          <label for="prof-bonus">Proficiency Bonus</label>
          <input id="prof-bonus" type="number" inputmode="numeric" pattern="[0-9]*" value="2" readonly/>
        </div>
        <div style="flex:1">
          <label for="power-save-ability">Power Save Ability</label>
          <select id="power-save-ability">
            <option value="str">STR</option><option value="dex">DEX</option><option value="con">CON</option>
            <option value="int">INT</option><option value="wis" selected>WIS</option><option value="cha">CHA</option>
          </select>
        </div>
        <div style="flex:1">
          <label for="power-save-dc">Power Save DC</label>
          <input id="power-save-dc" type="number" inputmode="numeric" pattern="[0-9]*" readonly/>
        </div>
      </div>
    </fieldset>
    <fieldset class="card">
      <legend data-animate-title>Saving Throws</legend>
      <div id="saves" class="grid ability-grid"></div>
    </fieldset>
    <fieldset class="card">
      <legend data-animate-title>Skills</legend>
      <div id="skills" class="grid ability-grid"></div>
    </fieldset>
  </fieldset>

  <!-- POWERS -->
  <fieldset data-tab="powers" class="card">
    <h2 class="card-title">Powers</h2>
    <div class="inline" style="justify-content:flex-end">
      <button id="add-power" style="max-width:180px">Add Power</button>
    </div>
    <div class="grid grid-2" id="powers"></div>

    <div class="inline" style="justify-content:space-between;margin-top:8px">
      <h3 style="margin:0">Signature Moves</h3>
      <button id="add-sig" style="max-width:200px">Add Signature Move</button>
    </div>
    <div class="grid grid-2" id="sigs"></div>
  </fieldset>

  <!-- GEAR -->
  <fieldset data-tab="gear" class="card">
    <h2 class="card-title">Gear</h2>
    <div class="grid grid-2">
      <div class="card gear-card">
        <h3 class="gear-card-title">Weapons</h3>
        <button id="add-weapon" class="btn-sm gear-card-action" style="max-width:140px">Add Weapon</button>
        <div id="weapons" class="grid grid-1"></div>
      </div>
      <div class="card gear-card">
        <h3 class="gear-card-title">Armor and Protection</h3>
        <button id="add-armor" class="btn-sm gear-card-action" style="max-width:160px">Add Armor</button>
        <div id="armors" class="grid grid-1"></div>
      </div>
      <div class="card" style="grid-column:1/-1">
        <div class="inline" style="justify-content:space-between">
          <h3 style="margin:0">Gear and Items</h3>
          <div class="inline">
            <button id="add-item" class="btn-sm" style="max-width:140px">Add Item</button>
            <button id="open-catalog" class="btn-sm" style="max-width:160px">Open Gear Catalog</button>
          </div>
        </div>
        <div id="items" class="grid grid-1"></div>
      </div>
    </div>
  </fieldset>

  <!-- STORY -->
  <fieldset data-tab="story" class="card">
    <h2 class="card-title">Character and Story</h2>
    <div class="grid grid-2">
      <div class="card"><label for="superhero">Superhero Identity</label><input id="superhero" placeholder="Vigilante Name"/></div>
      <div class="card"><label for="secret">Secret Identity</label><input id="secret" placeholder="Real name"/></div>
      <div class="card">
        <label for="publicIdentity">Public Identity</label>
        <select id="publicIdentity"><option value="Public">Public</option><option value="Secret" selected>Secret</option></select>
      </div>
      <div class="card">
        <label for="tier">Tier</label>
        <input id="tier" type="text" readonly/>
      </div>
      <div class="card" style="grid-column:1/-1">
        <label data-animate-title>Experience</label>
        <input id="xp" type="hidden" value="0"/>
        <div class="inline">
          <div class="bar-label">
            <progress id="xp-bar" max="2000" value="0"></progress>
            <span id="xp-pill">0/2000</span>
          </div>
        </div>
        <div class="inline">
          <label for="xp-amt" class="sr-only">Amount</label>
          <input id="xp-amt" data-view-allow type="number" inputmode="numeric" pattern="[0-9]*" placeholder="Amount"/>
          <select id="xp-mode" data-view-allow style="max-width:160px">
            <option value="add">Add XP</option>
            <option value="remove">Remove XP</option>
          </select>
          <button id="xp-submit" class="btn-sm">Submit</button>
        </div>
      </div>
      <div class="card">
        <label for="alignment">Alignment</label>
        <select id="alignment">
          <option value="">Select one</option>
          <option>Paragon (Lawful Light)</option>
          <option>Guardian (Neutral Light)</option>
          <option>Vigilante (Chaotic Light)</option>
          <option>Sentinel (Lawful Neutral)</option>
          <option>Outsider (True Neutral)</option>
          <option>Wildcard (Chaotic Neutral)</option>
          <option>Inquisitor (Lawful Shadow)</option>
          <option>Anti-Hero (Neutral Shadow)</option>
          <option>Renegade (Chaotic Shadow)</option>
        </select>
        <ul id="alignment-perks" class="perk-list"></ul>
      </div>
      <div class="card">
        <label for="classification">Classification</label>
        <select id="classification">
          <option value="">Select one</option><option>Mutant</option><option>Enhanced Human</option><option>Magic User</option><option>Alien/Extraterrestrial</option><option>Mystical Being</option>
        </select>
        <ul id="classification-perks" class="perk-list"></ul>
      </div>
      <div class="card">
        <label for="power-style">Primary Power Style</label>
        <select id="power-style">
          <option value="">Select one</option><option>Physical Powerhouse</option><option>Energy Manipulator</option><option>Speedster</option>
          <option>Telekinetic/Psychic</option><option>Illusionist</option><option>Shape-shifter</option><option>Elemental Controller</option>
        </select>
        <ul id="power-style-perks" class="perk-list"></ul>
      </div>
      <div class="card">
        <label for="power-style-2">Secondary Power Style</label>
        <select id="power-style-2">
          <option value="">Select one</option>
          <option>None</option>
          <option>Physical Powerhouse</option><option>Energy Manipulator</option><option>Speedster</option>
          <option>Telekinetic/Psychic</option><option>Illusionist</option><option>Shape-shifter</option><option>Elemental Controller</option>
        </select>
      </div>
      <div class="card">
        <label for="origin">Origin Story</label>
        <select id="origin">
          <option value="">Select one</option>
          <option>The Accident</option>
          <option>The Experiment</option>
          <option>The Legacy</option>
          <option>The Awakening</option>
          <option>The Pact</option>
          <option>The Lost Time</option>
          <option>The Exposure</option>
          <option>The Rebirth</option>
          <option>The Vigil</option>
          <option>The Redemption</option>
        </select>
        <ul id="origin-perks" class="perk-list"></ul>
      </div>
      <div class="card">
        <label for="credits" data-animate-title>Credits</label>
        <div class="inline">
          <span class="credits-currency" aria-hidden="true">₡</span>
          <span id="credits-total-pill" class="pill">0</span>
        </div>
        <div class="inline">
          <label for="credits-amt" class="sr-only">Amount</label>
          <input id="credits-amt" data-view-allow type="number" inputmode="numeric" pattern="[0-9]*" placeholder="Amount"/>
          <select id="credits-mode" data-view-allow>
            <option value="add">Add Credits</option>
            <option value="subtract">Spend Credits</option>
          </select>
          <button id="credits-submit" class="btn-sm" type="button">Apply</button>
        </div>
        <input id="credits" type="hidden" value="0"/>
      </div>
      <div class="card card-wide">
        <label data-animate-title>Faction Reputation</label>
        <div class="faction-rep">
          <div class="faction-rep__card">
            <div class="faction-rep__header">
              <span class="pill pill-sm">O.M.N.I.</span>
              <span id="omni-rep-tier" class="pill pill-sm">Neutral</span>
            </div>
            <progress id="omni-rep-bar" max="100" value="0"></progress>
            <div class="inline">
              <button id="omni-rep-gain" class="btn-sm">Gain</button>
              <button id="omni-rep-lose" class="btn-sm">Lose</button>
            </div>
            <input type="hidden" id="omni-rep" value="200"/>
            <div class="faction-rep__perk">
              <span class="faction-rep__perk-label">Current Perk</span>
              <p id="omni-rep-perk" class="perk"></p>
            </div>
          </div>
          <div class="faction-rep__card">
            <div class="faction-rep__header">
              <span class="pill pill-sm">P.F.V.</span>
              <span id="pfv-rep-tier" class="pill pill-sm">Neutral</span>
            </div>
            <progress id="pfv-rep-bar" max="100" value="0"></progress>
            <div class="inline">
              <button id="pfv-rep-gain" class="btn-sm">Gain</button>
              <button id="pfv-rep-lose" class="btn-sm">Lose</button>
            </div>
            <input type="hidden" id="pfv-rep" value="200"/>
            <div class="faction-rep__perk">
              <span class="faction-rep__perk-label">Current Perk</span>
              <p id="pfv-rep-perk" class="perk"></p>
            </div>
          </div>
          <div class="faction-rep__card">
            <div class="faction-rep__header">
              <span class="pill pill-sm">Cosmic Conclave</span>
              <span id="conclave-rep-tier" class="pill pill-sm">Neutral</span>
            </div>
            <progress id="conclave-rep-bar" max="100" value="0"></progress>
            <div class="inline">
              <button id="conclave-rep-gain" class="btn-sm">Gain</button>
              <button id="conclave-rep-lose" class="btn-sm">Lose</button>
            </div>
            <input type="hidden" id="conclave-rep" value="200"/>
            <div class="faction-rep__perk">
              <span class="faction-rep__perk-label">Current Perk</span>
              <p id="conclave-rep-perk" class="perk"></p>
            </div>
          </div>
          <div class="faction-rep__card">
            <div class="faction-rep__header">
              <span class="pill pill-sm">Greyline PMC</span>
              <span id="greyline-rep-tier" class="pill pill-sm">Neutral</span>
            </div>
            <progress id="greyline-rep-bar" max="100" value="0"></progress>
            <div class="inline">
              <button id="greyline-rep-gain" class="btn-sm">Gain</button>
              <button id="greyline-rep-lose" class="btn-sm">Lose</button>
            </div>
            <input type="hidden" id="greyline-rep" value="200"/>
            <div class="faction-rep__perk">
              <span class="faction-rep__perk-label">Current Perk</span>
              <p id="greyline-rep-perk" class="perk"></p>
            </div>
          </div>
          <div class="faction-rep__card">
            <div class="faction-rep__header">
              <span class="pill pill-sm">The Government</span>
              <span id="government-rep-tier" class="pill pill-sm">Neutral</span>
            </div>
            <progress id="government-rep-bar" max="100" value="0"></progress>
            <div class="inline">
              <button id="government-rep-gain" class="btn-sm">Gain</button>
              <button id="government-rep-lose" class="btn-sm">Lose</button>
            </div>
            <input type="hidden" id="government-rep" value="200"/>
            <div class="faction-rep__perk">
              <span class="faction-rep__perk-label">Current Perk</span>
              <p id="government-rep-perk" class="perk"></p>
            </div>
          </div>
          <div class="faction-rep__card">
            <div class="faction-rep__header">
              <span class="pill pill-sm">Public Opinion</span>
              <span id="public-rep-tier" class="pill pill-sm">Neutral</span>
            </div>
            <progress id="public-rep-bar" max="100" value="0"></progress>
            <div class="inline">
              <button id="public-rep-gain" class="btn-sm">Gain</button>
              <button id="public-rep-lose" class="btn-sm">Lose</button>
            </div>
            <input type="hidden" id="public-rep" value="200"/>
            <div class="faction-rep__perk">
              <span class="faction-rep__perk-label">Current Perk</span>
              <p id="public-rep-perk" class="perk"></p>
            </div>
          </div>
        </div>
      </div>

    </div>

    <div class="card">
      <label for="story-notes" data-animate-title>Backstory / Notes</label>
      <textarea id="story-notes" rows="6" placeholder="Key events, allies, vulnerabilities, research/training notes, etc."></textarea>
    </div>
      <h3>Character Questions</h3>
    <div class="grid grid-1">
      <div class="card"><label for="q-mask">Who are you behind the mask?</label><textarea id="q-mask" rows="2"></textarea></div>
      <div class="card"><label for="q-justice">What does justice mean to you?</label><textarea id="q-justice" rows="2"></textarea></div>
      <div class="card"><label for="q-fear">What is your biggest fear or unresolved trauma?</label><textarea id="q-fear" rows="2"></textarea></div>
      <div class="card"><label for="q-first-power">What moment first defined your sense of power—was it thrilling, terrifying, or tragic?</label><textarea id="q-first-power" rows="2"></textarea></div>
      <div class="card"><label for="q-origin-meaning">What does your Origin Story mean to you now?</label><textarea id="q-origin-meaning" rows="2"></textarea></div>
      <div class="card"><label for="q-before-powers">What was your life like before you had powers or before you remembered having them?</label><textarea id="q-before-powers" rows="2"></textarea></div>
      <div class="card"><label for="q-power-scare">What is one way your powers scare even you?</label><textarea id="q-power-scare" rows="2"></textarea></div>
      <div class="card"><label for="q-signature-move">What is your signature move or ability, and how does it reflect who you are?</label><textarea id="q-signature-move" rows="2"></textarea></div>
      <div class="card"><label for="q-emotional">What happens to your powers when you are emotionally compromised?</label><textarea id="q-emotional" rows="2"></textarea></div>
      <div class="card"><label for="q-no-line">What line will you never cross even if the world burns around you?</label><textarea id="q-no-line" rows="2"></textarea></div>
      <div class="card"><label for="q-alignment-fear">Which Alignment do you identify with, and which do you fear becoming?</label><textarea id="q-alignment-fear" rows="2"></textarea></div>
      <div class="card"><label for="q-opinion">Whose opinion matters more to you—civilians, teammates, or your faction superiors? Why?</label><textarea id="q-opinion" rows="2"></textarea></div>
      <div class="card"><label for="q-drive">What drives you to fight—justice, guilt, revenge, legacy, redemption, or something else?</label><textarea id="q-drive" rows="2"></textarea></div>
      <div class="card"><label for="q-walk-away">What would make you walk away from this life for good?</label><textarea id="q-walk-away" rows="2"></textarea></div>
      <div class="card"><label for="q-secret">What is one major secret you are keeping from the rest of the team?</label><textarea id="q-secret" rows="2"></textarea></div>
      <div class="card"><label for="q-vulnerable">What situation leaves you the most vulnerable—physically, emotionally, or strategically?</label><textarea id="q-vulnerable" rows="2"></textarea></div>
      <div class="card"><label for="q-admire">Which teammate do you admire the most and what do they have that you lack?</label><textarea id="q-admire" rows="2"></textarea></div>
      <div class="card"><label for="q-if-lost">If you lost your powers tomorrow, who would you still be?</label><textarea id="q-if-lost" rows="2"></textarea></div>
    </div>
  </fieldset>

</main>


<div class="overlay hidden" id="modal-load-list" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" tabindex="-1">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3>All Characters</h3>
    <div id="char-list" class="catalog"></div>
    <div class="actions">
      <button id="btn-save" class="btn-sm" type="button">Save</button>
      <button id="recover-save" class="btn-sm" type="button">Recover Save</button>
      <button id="create-character" class="btn-sm" type="button">Create New</button>
    </div>
  </div>
</div>

<div class="overlay hidden" id="modal-recover-char" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" tabindex="-1">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3>Select Character</h3>
    <div id="recover-char-list" class="catalog"></div>
  </div>
</div>

<div class="overlay hidden" id="modal-recover-list" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" tabindex="-1">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3>Recover Backup</h3>
    <div id="recover-list" class="catalog"></div>
  </div>
</div>

<div class="overlay hidden" id="modal-load" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" tabindex="-1">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <p id="load-confirm-text"></p>
    <div class="actions">
      <button id="load-cancel" class="btn-sm">Cancel</button>
      <button id="load-accept" class="btn-sm">Accept</button>
    </div>
  </div>
</div>

<div class="overlay hidden" id="modal-pin" aria-hidden="true">
  <section class="modal">
    <button id="pin-close" class="x" aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3 id="pin-title">Enter PIN</h3>
    <input id="pin-input" data-view-allow type="password" inputmode="numeric" pattern="[0-9]*" autocomplete="one-time-code">
    <div class="actions"><button id="pin-submit" class="somf-btn">OK</button></div>
  </section>
</div>

<!-- WELCOME MODAL -->
<div class="overlay hidden" id="modal-welcome" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" tabindex="-1">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3>Welcome to the Tracker</h3>
    <p>Create or load a character and use the tabs to manage stats, gear, and notes. Changes are saved in your browser and sync online when available.</p>
    <div class="actions">
      <button id="welcome-create-character" type="button">Create New Character</button>
      <button id="welcome-load-character" type="button">Load Character</button>
      <button id="welcome-skip" type="button">Skip</button>
    </div>
  </div>
</div>

<!-- HELP MODAL -->
<div class="overlay hidden" id="modal-help" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" tabindex="-1">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3>How to Use the Tracker</h3>
    <ul class="feature-list">
      <li><b>Theme</b> Tap the logo to cycle between light, high-contrast, and dark modes.</li>
      <li><b>Main menu</b> Access Load, Help, and Save from the menu.</li>
      <li><b>Tab navigation</b> Use the Combat, Abilities, Powers, Gear, and Story tabs to move between sections.</li>
      <li><b>Combat tools</b> Update HP/SP, mark death saves, adjust defenses, and make quick rolls or flips.</li>
      <li><b>Abilities management</b> Edit ability scores and proficiency bonuses on the Abilities tab.</li>
      <li><b>Powers management</b> Record powers or spells and track their uses in the Powers tab.</li>
      <li><b>Gear</b> Track equipment on the Gear tab.</li>
      <li><b>Story notes</b> Keep background details, quests, and other notes on the Story tab.</li>
      <li><b>Saving</b> Use Save to store your progress locally.</li>
    </ul>
    <h4>Frequently Asked Questions</h4>
    <ul class="qa-list">
      <li><b>Can I use the tracker offline?</b> Yes. The app stores data in your browser so it works offline.</li>
      <li><b>How do I change the theme?</b> Tap the logo to switch themes.</li>
      <li><b>Where do I adjust my HP or SP?</b> Visit the Combat tab and tap the current values to edit them.</li>
      <li><b>How do I roll a die or flip a coin?</b> Use the quick tools on the Combat tab.</li>
      <li><b>How can I manage my equipment?</b> Use the Gear tab to add and manage items.</li>
      <li><b>How do I save my character?</b> Choose <i>Save</i> from the menu to manually save your progress.</li>
    </ul>
  </div>
</div>

<!-- INITIATIVE MODAL -->
<div class="overlay hidden" id="modal-enc" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" tabindex="-1">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3>Encounter Tracker</h3>
    <fieldset class="inline">
      <legend class="sr-only">Add Combatant</legend>
      <label for="enc-name" class="sr-only">Name</label>
      <input id="enc-name" data-view-allow placeholder="Name"/>
      <label for="enc-init" class="sr-only">Init</label>
      <input id="enc-init" data-view-allow type="number" inputmode="numeric" pattern="[0-9]*" placeholder="Init"/>
      <button id="enc-add" class="btn-sm">Add</button>
    </fieldset>
    <div id="enc-list" class="catalog" style="margin-top:8px"></div>
    <div class="actions">
      <button id="enc-prev" class="btn-sm">Prev Turn</button>
      <button id="enc-next" class="btn-sm">Next Turn</button>
      <button id="enc-reset" class="btn-sm">Reset</button>
    </div>
  </div>
</div>

<div class="overlay hidden" id="modal-hp-roll" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" tabindex="-1">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3>Tier HP</h3>
    <label for="hp-roll-input" class="sr-only">Tier HP Bonus</label>
    <input id="hp-roll-input" data-view-allow type="number" inputmode="numeric" pattern="[0-9]*" placeholder="Tier HP Bonus"/>
    <ul id="hp-roll-list"></ul>
    <div class="actions">
      <button id="hp-roll-save" class="btn-sm">Add</button>
      <button class="btn-sm" data-close>Cancel</button>
    </div>
  </div>
</div>


<!-- LOG MODAL -->
<div class="overlay hidden" id="modal-log" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" tabindex="-1">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3>Action Log</h3>
    <div id="log-action" class="catalog"></div>
    <div class="actions"><button id="log-full" class="btn-sm">Full Log</button><button class="btn-sm" data-close>Close</button></div>
  </div>
</div>


<div class="overlay hidden" id="modal-campaign" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" tabindex="-1">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3>Campaign Log</h3>
    <label for="campaign-entry" class="sr-only">Campaign Log Entry</label>
    <textarea id="campaign-entry" data-view-allow rows="2" placeholder="Session notes..."></textarea>
    <div class="actions">
      <button id="campaign-add" class="btn-sm" style="max-width:140px">Add Entry</button>
    </div>
    <div id="campaign-log" class="catalog"></div>
    <div class="actions"><button class="btn-sm" data-close>Close</button></div>
  </div>
</div>

<div class="overlay hidden" id="modal-log-full" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" tabindex="-1">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3>Full Action Log</h3>
    <div id="full-log-action" class="catalog"></div>
    <div class="actions"><button class="btn-sm" data-close>Close</button></div>
  </div>
</div>

<div class="overlay hidden" id="modal-faction-perk" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-label="Faction Perk" tabindex="-1">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3>Faction Perk</h3>
    <ul id="modal-faction-perk-list" class="perk-list"></ul>
  </div>
</div>


<!-- GEAR CATALOG -->
<div class="overlay hidden" id="modal-catalog" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" tabindex="-1">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3>Gear Catalog</h3>
    <fieldset class="inline" style="margin:6px 0">
      <legend class="sr-only">Filters</legend>
      <label for="catalog-filter-style" class="sr-only">Style</label>
      <select id="catalog-filter-style" data-view-allow style="max-width:260px"></select>
      <label for="catalog-filter-type" class="sr-only">Type</label>
      <select id="catalog-filter-type" data-view-allow style="max-width:180px"><option value="">All Types</option><option>Armor</option><option>Shield</option><option>Utility</option></select>
      <label for="catalog-filter-rarity" class="sr-only">Rarity</label>
      <select id="catalog-filter-rarity" data-view-allow style="max-width:160px"><option value="">All Rarities</option><option>Common</option><option>Uncommon</option><option>Rare</option><option>Elite</option><option>Legendary</option></select>
      <button id="catalog-add-custom" class="btn-sm" type="button" data-view-allow>Add Custom Item</button>
    </fieldset>
    <div id="catalog-list" class="catalog"></div>
</div>
</div>

<div class="overlay hidden" id="modal-custom-item" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" tabindex="-1">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3>Create Custom Item</h3>
    <p>Select the type of custom item to add.</p>
    <div class="custom-type-grid">
      <button class="btn-sm" type="button" data-custom-type="weapon">Weapon</button>
      <button class="btn-sm" type="button" data-custom-type="armor">Armor</button>
      <button class="btn-sm" type="button" data-custom-type="shield">Shield</button>
      <button class="btn-sm" type="button" data-custom-type="utility">Utility</button>
      <button class="btn-sm" type="button" data-custom-type="item">Item</button>
    </div>
    <div class="actions">
      <button class="btn-sm" type="button" data-close>Cancel</button>
    </div>
  </div>
</div>

<!-- RULES -->
<div class="overlay hidden" id="modal-rules" aria-hidden="true">
  <div class="modal modal-rules" role="dialog" aria-modal="true" aria-label="Rules Help" tabindex="-1">
    <button class="x" data-close aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <pre id="rules-text"></pre>
  </div>
</div>

<div id="somf-min-modal" class="somf-modal" hidden>
  <div class="somf-modal__backdrop" data-somf-dismiss></div>
  <div class="somf-modal__card somf-modal__card--image">
    <button id="somf-min-close" class="somf-modal__x" aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <img id="somf-min-image" class="somf-modal__art" alt="Shard artwork" loading="lazy">
  </div>
</div>

<footer>
  <p>When the whole world tells you to move, it's your job to plant yourself like a tree by the river of truth and tell the whole world - no, YOU move.</p>
  <button id="dm-login" class="dm-login-btn" aria-label="DM Tools">
    <img class="dm-login-logo" src="images/XoVrom.png" alt="XoVrom Industries logo">
  </button>
</footer>
<div id="dm-tools-menu" class="dm-tools-menu" hidden>
  <button id="dm-tools-tsomf" class="btn-sm">TSoMF</button>
  <button id="dm-tools-notifications" class="btn-sm">Notifications</button>
  <button id="dm-tools-characters" class="btn-sm">Characters</button>
  <button id="dm-tools-logout" class="btn-sm">Logout</button>
</div>
<button id="dm-tools-toggle" class="dm-tools-toggle" hidden aria-haspopup="true" aria-controls="dm-tools-menu" aria-label="DM tools menu">
  <svg class="dm-tools-toggle__icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true">
    <path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.592c.55 0 1.02.398 1.11.94l.214 1.285c.063.374.326.686.672.838.347.152.744.142 1.08-.026l1.155-.577a1.125 1.125 0 011.45.516l1.296 2.247a1.125 1.125 0 01-.286 1.431l-1.003.753a1.125 1.125 0 00-.401 1.13l.214 1.285c.09.542-.262 1.06-.78 1.12l-1.29.143a1.125 1.125 0 00-.966.86l-.213 1.285c-.091.542-.56.94-1.111.94h-2.591c-.55 0-1.02-.398-1.11-.94l-.214-1.285a1.125 1.125 0 00-.672-.838 1.125 1.125 0 00-1.08.027l-1.155.577a1.125 1.125 0 01-1.45-.516l-1.296-2.247a1.125 1.125 0 01.286-1.431l1.003-.753a1.125 1.125 0 00.401-1.13l-.214-1.285a1.125 1.125 0 01.78-1.12l1.29-.143a1.125 1.125 0 00.966-.86l.213-1.285z" />
    <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
  </svg>
  <span class="sr-only">DM Tools</span>
</button>
<div class="overlay hidden" id="dm-login-modal" aria-hidden="true">
  <section class="modal">
    <button id="dm-login-close" class="x" aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3>DM Login</h3>
    <input id="dm-login-pin" data-view-allow type="password" inputmode="numeric" pattern="[0-9]*" autocomplete="one-time-code">
    <div class="actions"><button id="dm-login-submit" class="somf-btn">Enter</button></div>
  </section>
</div>
<div class="overlay hidden" id="dm-notifications-modal" aria-hidden="true">
  <section class="modal">
    <button id="dm-notifications-close" class="x" aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3>Notifications</h3>
    <ol id="dm-notifications-list"></ol>
  </section>
</div>
<div class="overlay hidden" id="dm-characters-modal" aria-hidden="true">
  <section class="modal dm-characters">
    <button id="dm-characters-close" class="x" aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <h3>All Characters</h3>
    <ul id="dm-characters-list" class="dm-characters-list"></ul>
  </section>
</div>
<div class="overlay hidden" id="dm-character-modal" aria-hidden="true">
  <section class="modal dm-character">
    <button id="dm-character-close" class="x" aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <div id="dm-character-sheet" class="dm-character-sheet" title="Character Sheet"></div>
  </section>
</div>
<div class="overlay hidden" id="modal-somf-dm" aria-hidden="true">
  <section id="somf-dm" class="modal somf-dm">
    <button id="somfDM-close" class="x" aria-label="Close">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12"/>
      </svg>
    </button>
    <header class="somf-dm__hdr">
      <h3>DM • Shards <span id="somfDM-cardCount"></span></h3>
      <div class="somf-dm__hdr-controls">
        <div class="somf-dm__toggles">
          <label class="somf-switch"><span id="somfDM-playerCard-state">Off</span><input id="somfDM-playerCard" type="checkbox"><span>Reveal Shards</span></label>
        </div>
        <div class="somf-dm__actions">
          <button id="somfDM-reset" class="somf-btn">Reset</button>
        </div>
      </div>
    </header>

    <nav class="somf-dm__tabs">
      <button data-tab="cards" class="somf-dm-tabbtn active">Shards List</button>
      <button data-tab="resolve" class="somf-dm-tabbtn">Resolve</button>
      <button data-tab="npcs" class="somf-dm-tabbtn">NPCs</button>
      <button data-tab="items" class="somf-dm-tabbtn">Items</button>
    </nav>

    <section id="somfDM-tab-cards" class="somf-dm-tab somf-dm__tab active"></section>

    <section id="somfDM-tab-resolve" class="somf-dm-tab somf-dm__tab">
      <div class="somf-dm__resolve">
        <aside class="somf-dm__left">
          <h4>Incoming Draws</h4>
          <ol id="somfDM-incoming" class="somf-dm__list"></ol>
        </aside>
        <main class="somf-dm__main">
          <div id="somfDM-noticeView" class="somf-dm__card"></div>
          <div class="somf-dm__actions">
            <button id="somfDM-markResolved" class="somf-btn somf-primary" disabled>Mark Resolved</button>
            <button id="somfDM-spawnNPC" class="somf-btn" disabled>Spawn Related NPC</button>
          </div>
        </main>
      </div>
      <h4>Resolution Methods</h4>
      <ol id="somfDM-resolveOptions" class="somf-dm__list"></ol>
    </section>

    <section id="somfDM-tab-npcs" class="somf-dm-tab somf-dm__tab">
      <ul id="somfDM-npcList" class="somf-dm__list"></ul>
    </section>

    <section id="somfDM-tab-items" class="somf-dm-tab somf-dm__tab">
      <ul id="somfDM-itemList" class="somf-dm__list"></ul>
    </section>
  </section>
</div>

<div class="overlay hidden" id="somfDM-npcModal" aria-hidden="true">
  <section id="somfDM-npcModalCard" class="modal somf-dm"></section>
</div>

<!-- Toasts + Tiny Ping -->
<ul id="somfDM-notifications" class="somf-dm__queue"></ul>
<div id="somfDM-toasts" class="somf-dm__toasts"></div>
<audio id="somfDM-ping" preload="auto"></audio>

<div id="down-animation" aria-hidden="true" hidden></div>
<div id="death-animation" aria-hidden="true" hidden>
  <img src="images/death-animation.svg" alt="" decoding="async" loading="lazy" />
</div>
<div id="damage-animation" aria-hidden="true" hidden></div>
<div id="heal-animation" aria-hidden="true" hidden></div>
<div id="save-animation" aria-hidden="true" hidden></div>
<div id="coin-animation" aria-hidden="true" hidden></div>
<div id="sp-animation" aria-hidden="true" hidden></div>
<div id="load-animation" aria-hidden="true" hidden></div>
<div id="draw-lightning" aria-hidden="true" hidden></div>
<div id="draw-flash" aria-hidden="true" hidden></div>
<div class="toast" id="toast" role="status" aria-live="polite"></div>
</div>
<script type="module" src="scripts/header-title.js"></script>
<script type="module" src="scripts/animated-titles.js"></script>
<script type="module" src="scripts/main.js"></script>
<script type="module" src="scripts/dm.js"></script>
<script type="module" src="scripts/somf-firebase.js"></script>
<script src="shard-of-many-fates.js"></script>

</body>
</html>
