:root{--bg:#0e1117;--surface:#151a23;--surface-2:#0b0f16;--text:#f3f4f6;--muted:#9ca3af;--accent:#3b82f6;--accent-2:#1e40af;--line:rgba(255,255,255,.12);--shadow:0 8px 28px rgba(0,0,0,.35);--text-on-accent:#fff;--radius:12px;--transition:all .2s ease}
:root.theme-light{--bg:#f9fafb;--surface:#fff;--surface-2:#f3f4f6;--text:#111827;--muted:#6b7280;--accent:#3b82f6;--accent-2:#1e40af;--line:rgba(0,0,0,.1);--shadow:0 8px 28px rgba(0,0,0,.2);--text-on-accent:#fff}
:root.theme-high{--bg:#000;--surface:#000;--surface-2:#000;--text:#fff;--muted:#fff;--accent:#ff0;--accent-2:#0ff;--line:#fff;--shadow:none;--text-on-accent:#000}
*,*::before,*::after{box-sizing:border-box}
html{-webkit-text-size-adjust:100%;-moz-text-size-adjust:100%;text-size-adjust:100%}
body,h1,h2,h3,h4,p,figure,blockquote,dl,dd{margin:0}
html{height:100%}body{min-height:100%}
body{margin:0;background:var(--bg);color:var(--text);font-family:'Inter',system-ui,-apple-system,Segoe UI,Arial,sans-serif;-webkit-font-smoothing:antialiased;overflow-x:hidden;line-height:1.6;font-size:16px}
header{position:sticky;top:0;z-index:20;background:var(--surface);box-shadow:var(--shadow);padding:calc(12px + env(safe-area-inset-top)) 14px 12px;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px)}
.top{display:flex;align-items:center;justify-content:space-between;gap:10px}
h1{margin:0;font-size:1.1rem;color:var(--accent);font-weight:700}
.actions{display:flex;gap:8px}
@media(max-width:600px){
  .top{flex-direction:column;align-items:center;text-align:center}
  .actions{flex-wrap:wrap;justify-content:center}
  .tabs{justify-content:center}
}
.icon{width:40px;height:40px;border-radius:var(--radius);background:var(--surface-2);border:1px solid var(--accent);color:var(--accent);display:inline-flex;align-items:center;justify-content:center;transition:var(--transition)}
.icon svg,.modal .x svg{width:24px;height:24px}
.icon:hover{background:var(--accent);color:var(--text-on-accent)}
.icon:active{transform:translateY(1px)}
.icon:focus-visible,.modal .x:focus-visible{outline:2px solid var(--accent);outline-offset:2px}
[data-tip]{position:relative;cursor:help}
[data-tip]:hover::after,[data-tip]:focus::after{content:attr(data-tip);position:absolute;bottom:calc(100% + 6px);left:50%;transform:translateX(-50%);background:var(--surface-2);color:var(--text);padding:4px 8px;border-radius:var(--radius);box-shadow:var(--shadow);white-space:nowrap;font-size:.75rem;z-index:1500}
.tabs{margin-top:10px;display:flex;gap:8px;flex-wrap:wrap}
.tab{flex:1 0 110px;padding:10px 12px;border-radius:var(--radius);border:1px solid var(--accent);background:var(--surface-2);color:var(--text);font-weight:700;text-align:center;transition:var(--transition)}
.tab:hover{background:var(--accent);color:var(--text-on-accent)}
.tab.active{background:var(--accent);color:var(--text-on-accent)}
main{max-width:980px;margin:16px auto;padding:0 12px calc(16px + env(safe-area-inset-bottom))}
section{background:var(--surface);border:1px solid var(--line);border-radius:var(--radius);padding:14px;margin-bottom:14px;box-shadow:var(--shadow)}
section h2{margin:0 0 10px;color:var(--accent);font-size:1.05rem}
.grid{display:grid;gap:12px}
.grid-1{grid-template-columns:1fr}
.grid-2{grid-template-columns:1fr}
.grid-3{grid-template-columns:1fr}
@media(min-width:600px){.grid-2{grid-template-columns:repeat(2,1fr)}.grid-3{grid-template-columns:repeat(2,1fr)}}
@media(min-width:900px){.grid-3{grid-template-columns:repeat(3,1fr)}}
#statuses{grid-template-columns:repeat(2,1fr)}
label{display:block;font-weight:700;margin-bottom:6px}
input:not([type="checkbox"]),select,textarea,button{-webkit-appearance:none;-moz-appearance:none;appearance:none;width:100%;border-radius:var(--radius);border:1px solid var(--accent);background:var(--surface-2);color:var(--text);padding:12px;transition:var(--transition)}
select{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 8l4 4 4-4'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;background-size:16px;padding-right:40px}
input[type="checkbox"]{width:15px;height:15px;max-width:15px;max-height:15px;-webkit-appearance:checkbox;-moz-appearance:checkbox;appearance:checkbox;flex:0 0 auto;padding:0;margin:0 4px 0 0;}
button{background:linear-gradient(135deg,var(--accent),var(--accent-2));color:var(--text-on-accent);border:none;font-weight:700;min-height:44px;cursor:pointer}
button:hover{filter:brightness(1.1);transform:translateY(-1px)}
button:active{transform:translateY(0)}
button.loading{opacity:.8;pointer-events:none;position:relative;padding-right:2.5em}
button.loading::after{content:"";position:absolute;width:1em;height:1em;border:2px solid currentColor;border-top-color:transparent;border-radius:50%;right:8px;top:50%;transform:translateY(-50%);animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.btn-sm{min-height:36px;padding:8px 10px;border-radius:var(--radius)}
.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
.inline{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.inline>input:not([type="checkbox"]),
.inline>select,
.inline>textarea,
.inline>button,
.inline>progress{flex:1;width:auto}
.inline>.pill,
.inline>.sr-only{flex:0;width:auto}
@media(max-width:600px){
  .inline{flex-direction:column;align-items:stretch}
  .inline>input:not([type="checkbox"]),
  .inline>select,
  .inline>textarea,
  .inline>button,
  .inline>progress{flex:none;width:100%}
}
.pill{display:inline-block;padding:6px 10px;border:1px solid var(--accent);border-radius:999px;color:var(--accent);font-size:.85rem;white-space:nowrap}
.pill.result{font-size:1rem;font-weight:700;}
.death-saves{display:grid;grid-template-columns:repeat(3,auto);gap:8px;}
.death-saves input[type="checkbox"]{margin:0;}
.sp-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;flex:1;}
.sp-grid .btn-sm{width:100%;}
.card{border:1px solid var(--line);border-radius:var(--radius);padding:12px;display:flex;flex-direction:column;gap:10px;cursor:grab;transition:box-shadow .2s ease,transform .2s ease}
.card:hover{box-shadow:0 12px 28px rgba(0,0,0,.45);transform:translateY(-2px)}
.card.dragging{opacity:.5}
.catalog{max-height:360px;overflow:auto;border:1px dashed var(--line);border-radius:10px;padding:6px}
.perk-list{margin:0;padding-left:20px;list-style:disc}
.catalog-item{display:grid;grid-template-columns:auto 1fr auto;gap:10px;align-items:center;padding:8px;border-bottom:1px solid var(--line)}
.catalog-item:last-child{border-bottom:none}
.catalog-item.active{background:var(--accent);color:var(--text-on-accent)}
.catalog-item.active .pill{border-color:var(--text-on-accent);color:var(--text-on-accent)}
.small{font-size:.9rem;color:var(--muted)}
#modal-rules .pdf-controls{position:absolute;bottom:16px;right:16px;display:flex;flex-direction:column;gap:8px;z-index:1}
.overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.6);backdrop-filter:blur(2px);z-index:1000;padding:16px}
.overlay.hidden{display:none!important}
.modal{background:var(--surface);border:1px solid var(--accent);border-radius:var(--radius);max-width:720px;width:100%;padding:24px;box-shadow:var(--shadow);position:relative;max-height:calc(100vh - 32px);overflow:auto}
.modal h3{margin:0 0 8px;color:var(--accent)}
.modal .x{position:sticky;top:8px;margin-left:auto;margin-right:8px;background:transparent;border:none;color:inherit;cursor:pointer;display:flex;align-items:center;justify-content:center;width:32px;height:32px;transition:var(--transition);z-index:2}
.modal .x:hover{color:var(--accent)}
.modal .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}
#modal-rules{align-items:stretch;padding:0}
#modal-rules .modal-rules{max-width:none;width:100%;height:100%;border-radius:0;border:none;padding:0;max-height:none}
#modal-rules .modal-rules iframe{width:100%;height:100%;border:none}
.toast{position:fixed;bottom:18px;right:18px;background:var(--surface);border:1px solid var(--accent);padding:10px 12px;border-radius:var(--radius);opacity:0;transform:translateY(8px);transition:opacity .2s,transform .2s;z-index:2000}
.toast.show{opacity:1;transform:translateY(0)}
.toast.success{border-color:#16a34a;color:#16a34a}
.toast.error{border-color:#dc2626;color:#dc2626}

/* ability grid */
.ability-grid{grid-template-columns:repeat(2,1fr)}

.ability-box{
  border:1px solid var(--line);
  border-radius:var(--radius);
  padding:8px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:6px;
}

.ability-box label{
  margin-bottom:0;
}

.ability-box .score{
  position:relative;
  width:100%;
}

.ability-box select{
  width:100%;
  height:72px;
  font-size:1.8rem;
  text-align:center;
}

.ability-box .mod{
  position:absolute;
  bottom:4px;
  right:4px;
  padding:4px 6px;
  border:1px solid var(--accent);
  border-radius:var(--radius);
  background:var(--surface-2);
  color:var(--accent);
  font-size:.85rem;
}

#hp-roll-list{
  margin:8px 0 0;
  padding:0;
  list-style:none;
}
#hp-roll-list li{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-top:4px;
}
#hp-roll-list li button{
  flex:0 0 auto;
}

/* Enhanced form control feedback */
input:not([type="checkbox"]):hover,
select:hover,
textarea:hover{
  border-color:var(--accent-2);
}

input:not([type="checkbox"]):focus,
select:focus,
textarea:focus{
  border-color:var(--accent);
  box-shadow:0 0 0 2px rgba(59,130,246,.5);
  outline:none;
}

/* Validation states */
input:not([type="checkbox"]):invalid,
textarea:invalid{
  border-color:#dc2626;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='none' stroke='%23dc2626' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 6l8 8M6 14l8-8'/%3E%3C/svg%3E");
  background-repeat:no-repeat;
  background-position:right 12px center;
  background-size:16px;
  padding-right:40px;
}

select:invalid{
  border-color:#dc2626;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='none' stroke='%23dc2626' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 6l8 8M6 14l8-8'/%3E%3C/svg%3E"),url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 8l4 4 4-4'/%3E%3C/svg%3E");
  background-repeat:no-repeat,no-repeat;
  background-position:right 12px center,right 36px center;
  background-size:16px 16px,16px 16px;
  padding-right:64px;
}

input:not([type="checkbox"])[required]:valid:not(:placeholder-shown),
textarea[required]:valid:not(:placeholder-shown){
  border-color:#16a34a;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='none' stroke='%2316a34a' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M5 10l3 3 7-7'/%3E%3C/svg%3E");
  background-repeat:no-repeat;
  background-position:right 12px center;
  background-size:16px;
  padding-right:40px;
}

select[required]:valid{
  border-color:#16a34a;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='none' stroke='%2316a34a' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M5 10l3 3 7-7'/%3E%3C/svg%3E"),url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 8l4 4 4-4'/%3E%3C/svg%3E");
  background-repeat:no-repeat,no-repeat;
  background-position:right 12px center,right 36px center;
  background-size:16px 16px,16px 16px;
  padding-right:64px;
}

