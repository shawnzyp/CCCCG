:root{--bg:#0e1117;--surface:#151a23;--surface-2:#0b0f16;--text:#f3f4f6;--muted:#9ca3af;--accent:#3b82f6;--accent-2:#1e40af;--line:rgba(255,255,255,.12);--shadow:0 8px 28px rgba(0,0,0,.35);--text-on-accent:#fff;--radius:12px;--transition:all .2s ease;--success:#16a34a;--error:#dc2626;--chevron:url("data:image/svg+xml,%3Csvg%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20viewBox%3D'0%200%2020%2020'%20fill%3D'none'%20stroke%3D'currentColor'%20stroke-width%3D'2'%20stroke-linecap%3D'round'%20stroke-linejoin%3D'round'%3E%3Cpath%20d%3D'M6%208l4%204%204-4'%2F%3E%3C%2Fsvg%3E")}
:root.theme-light{--bg:#f9fafb;--surface:#fff;--surface-2:#f3f4f6;--text:#111827;--muted:#6b7280;--accent:#3b82f6;--accent-2:#1e40af;--line:rgba(0,0,0,.1);--shadow:0 8px 28px rgba(0,0,0,.2);--text-on-accent:#fff;--success:#16a34a;--error:#dc2626}
:root.theme-high{--bg:#000;--surface:#000;--surface-2:#000;--text:#fff;--muted:#fff;--accent:#ff0;--accent-2:#0ff;--line:#fff;--shadow:none;--text-on-accent:#000;--success:#0f0;--error:#f00}
:root.theme-forest{--bg:linear-gradient(135deg,#0b3d0b,#1b5e20);--surface:rgba(34,90,34,.8);--surface-2:rgba(20,60,20,.8);--text:#e8f5e9;--muted:#a5d6a7;--accent:#66bb6a;--accent-2:#2e7d32;--line:rgba(255,255,255,.1);--shadow:0 8px 28px rgba(0,0,0,.35);--text-on-accent:#0e1117;--success:#81c784;--error:#e57373}
:root.theme-ocean{--bg:linear-gradient(135deg,#0e0e52,#4f9fd8);--surface:rgba(15,35,75,.8);--surface-2:rgba(10,25,60,.8);--text:#e0f7fa;--muted:#90a4ae;--accent:#00bcd4;--accent-2:#006064;--line:rgba(255,255,255,.1);--shadow:0 8px 28px rgba(0,0,0,.35);--text-on-accent:#0e1117;--success:#4db6ac;--error:#ef5350}
*,*::before,*::after{box-sizing:border-box}
html{-webkit-text-size-adjust:100%;-moz-text-size-adjust:100%;text-size-adjust:100%}
body,h1,h2,h3,h4,p,figure,blockquote,dl,dd{margin:0}
html{height:100%;background:var(--bg);transition:var(--transition);}body{min-height:100%}
body{margin:0;background:transparent;color:var(--text);font-family:'Inter',system-ui,-apple-system,Segoe UI,Arial,sans-serif;-webkit-font-smoothing:antialiased;overflow-x:hidden;line-height:1.6;font-size:16px;transition:var(--transition)}
h1,h2,h3,h4{font-family:inherit;line-height:1.25;margin:0 0 .5em}
h1{font-size:2rem;font-weight:700;color:var(--accent)}
header h1{font-size:1rem}
h2{font-size:1.5rem;font-weight:600;color:var(--accent)}
h3{font-size:1.25rem;font-weight:600}
header{position:sticky;top:0;z-index:20;background:var(--surface);box-shadow:var(--shadow);padding:calc(8px + env(safe-area-inset-top)) 10px 8px;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);display:flex;flex-direction:column;transition:padding .3s ease}
header.compact{flex-direction:row;align-items:center;justify-content:flex-end;padding:4px 10px}
header #btn-theme,header h1,header #btn-dm{transition:opacity .3s ease,max-width .3s ease,margin .3s ease,padding .3s ease;overflow:hidden}
header.compact #btn-theme,header.compact h1,header.compact #btn-dm{opacity:0;max-width:0;margin:0;padding:0;pointer-events:none}
header.compact .top{margin-left:8px;margin-right:0;flex:0 0 auto;order:2}
header.compact .tabs{margin-top:0;flex:1;order:1;justify-content:space-evenly}
header.hide-tabs .tabs{opacity:0;pointer-events:none}
.top{display:flex;align-items:center;justify-content:center;gap:8px;transition:var(--transition)}
.title-group{display:flex;align-items:center;gap:6px}
.actions{display:flex;gap:6px}
.dropdown{position:relative}
.menu{position:absolute;top:calc(100% + 4px);right:0;display:none;flex-direction:column;background:var(--surface-2);border:1px solid var(--accent);border-radius:var(--radius);box-shadow:var(--shadow);z-index:50}
.menu.show{display:flex}
.menu button{background:transparent;color:var(--text);border:none;padding:8px 12px;text-align:left;font-weight:400;min-height:auto;white-space:nowrap}
.menu button:hover{background:var(--accent);color:var(--text-on-accent)}
@media(max-width:600px){
  .top{flex-wrap:wrap;justify-content:center;text-align:center}
  .actions{flex-wrap:wrap;justify-content:center}
  .tabs{justify-content:space-evenly}
}
.icon,.tab{padding:2px;width:27px;height:27px;min-height:27px;aspect-ratio:1/1;border-radius:var(--radius);background:var(--surface-2);border:1px solid var(--accent);color:var(--accent);display:inline-flex;align-items:center;justify-content:center;transition:var(--transition)}
.icon svg,.tab svg{width:27px;height:27px}
.modal .x svg{width:20px;height:20px}
.icon:hover,.tab:hover{background:var(--accent);color:var(--text-on-accent)}
.icon:active{transform:translateY(1px)}
.icon:focus-visible,.tab:focus-visible,.modal .x:focus-visible{outline:2px solid var(--accent);outline-offset:2px}
[data-tip]{position:relative;cursor:help}
[data-tip]:hover::after,[data-tip]:focus::after{content:attr(data-tip);position:absolute;bottom:calc(100% + 6px);left:50%;transform:translateX(-50%);background:var(--surface-2);color:var(--text);padding:4px 8px;border-radius:var(--radius);box-shadow:var(--shadow);white-space:nowrap;font-size:.75rem;z-index:1500}
.tabs{margin-top:6px;display:flex;flex-wrap:nowrap;justify-content:space-evenly;width:100%;gap:0;transition:var(--transition)}
.tab.active{background:var(--accent);color:var(--text-on-accent)}
main{max-width:65ch;margin:16px auto;padding:0 12px calc(16px + env(safe-area-inset-bottom))}
section{background:var(--surface);border:1px solid var(--line);border-radius:var(--radius);padding:14px;margin-bottom:14px;box-shadow:var(--shadow)}
section h2{margin:0 0 10px}
p{max-width:65ch}
footer{text-align:center;font-size:9pt;margin-top:24px;padding:12px 0;color:var(--muted)}
footer p{max-width:none}
.grid{display:grid;gap:12px}
.grid-1{grid-template-columns:1fr}
.grid-2{grid-template-columns:1fr}
.grid-3{grid-template-columns:1fr}
@media(min-width:600px){.grid-2{grid-template-columns:repeat(2,1fr)}.grid-3{grid-template-columns:repeat(2,1fr)}}
@media(min-width:900px){.grid-3{grid-template-columns:repeat(3,1fr)}}
#statuses{grid-template-columns:repeat(2,1fr)}
label{display:block;font-weight:700;margin-bottom:6px}
input:not([type="checkbox"]),select,textarea,button{-webkit-appearance:none;-moz-appearance:none;appearance:none;width:100%;border-radius:var(--radius);border:1px solid var(--accent);background:var(--surface-2);color:var(--text);padding:12px;transition:var(--transition)}
select{background-image:var(--chevron);background-repeat:no-repeat;background-position:right 12px center;background-size:16px;padding-right:40px}
input[type="checkbox"]{width:15px;height:15px;max-width:15px;max-height:15px;-webkit-appearance:checkbox;-moz-appearance:checkbox;appearance:checkbox;flex:0 0 auto;padding:0;margin:0 4px 0 0;}
button{background:linear-gradient(135deg,var(--accent),var(--accent-2));color:var(--text-on-accent);border:none;font-weight:700;min-height:44px;cursor:pointer}
button:hover{filter:brightness(1.1);transform:translateY(-1px)}
button:active{transform:translateY(0)}
button.loading{opacity:.8;pointer-events:none;position:relative;padding-right:2.5em}
button.loading::after{content:"";position:absolute;width:1em;height:1em;border:2px solid currentColor;border-top-color:transparent;border-radius:50%;right:8px;top:50%;transform:translateY(-50%);animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.btn-sm{min-height:36px;padding:8px 10px;border-radius:var(--radius)}
.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
.inline{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.inline>input:not([type="checkbox"]),
.inline>select,
.inline>textarea,
.inline>button,
.inline>progress{flex:1;width:auto}
.inline>.pill,
.inline>.sr-only{flex:0;width:auto}
@media(max-width:600px){
  .inline{flex-direction:column;align-items:stretch}
  .inline>input:not([type="checkbox"]),
  .inline>select,
  .inline>textarea,
  .inline>button,
  .inline>progress{flex:none;width:100%}
}
.pill{display:inline-block;padding:6px 10px;border:1px solid var(--accent);border-radius:999px;color:var(--accent);font-size:.85rem;white-space:nowrap}
.pill-sm{padding:2px 6px;font-size:.75rem}
.pill.result{font-size:1rem;font-weight:700;}
.pill.result:empty::before{content:attr(data-placeholder);visibility:hidden;}
.pill.result.rolling{animation:dicePop .6s ease;}
@keyframes dicePop{
  0%{transform:scale(0);opacity:0;}
  50%{transform:scale(1.2);opacity:1;}
  100%{transform:scale(1);opacity:1;}
}
.roll-flip-grid{grid-template-columns:repeat(2,1fr);gap:8px;}
.roll-flip-grid .inline{flex-wrap:nowrap;gap:4px;}
.roll-flip-grid select,
.roll-flip-grid input,
.roll-flip-grid button,
.roll-flip-grid .pill{padding:4px 6px;min-height:28px;}
.roll-flip-grid .pill.result{font-size:.85rem;min-width:40px;}
#dice-count{flex:0 0 30px;width:30px;}
@media(max-width:600px){
  .roll-flip-grid{grid-template-columns:repeat(2,1fr);}
  .roll-flip-grid .inline{flex-direction:row;}
  .roll-flip-grid .inline>input:not([type="checkbox"]),
  .roll-flip-grid .inline>select{flex:1;width:auto;}
  .roll-flip-grid .inline>button{flex:0 0 auto;width:auto;}
}
.death-saves{display:grid;grid-template-columns:repeat(3,auto);gap:24px;justify-content:center;}
.death-saves input[type="checkbox"]{margin:0;}
#death-animation{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:10rem;
  color:var(--text);
  pointer-events:none;
  opacity:0;
  z-index:3000;
}
#death-animation.show{
  animation:deathFade 2s ease forwards;
}
@keyframes deathFade{
  0%{opacity:0;}
  20%{opacity:1;}
  80%{opacity:1;}
  100%{opacity:0;}
}
#damage-animation{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:8rem;
  color:var(--error);
  pointer-events:none;
  opacity:0;
  z-index:3000;
}
#damage-animation.show{
  animation:damagePop 1s ease forwards;
}
@keyframes damagePop{
  0%{transform:scale(0);opacity:0;}
  30%{transform:scale(1.2);opacity:1;}
  100%{transform:scale(1);opacity:0;}
}
#heal-animation{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:8rem;
  color:var(--success);
  pointer-events:none;
  opacity:0;
  z-index:3000;
}
#heal-animation.show{
  animation:healRise 1s ease forwards;
}
@keyframes healRise{
  0%{transform:translateY(20px);opacity:0;}
  30%{transform:translateY(0);opacity:1;}
  100%{transform:translateY(-20px);opacity:0;}
}
#save-animation{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:6rem;
  color:var(--accent);
  pointer-events:none;
  opacity:0;
  z-index:3000;
}
#save-animation.show{
  animation:saveSpin 1s ease forwards;
}
@keyframes saveSpin{
  0%{transform:scale(0) rotate(-180deg);opacity:0;}
  30%{transform:scale(1.2) rotate(0deg);opacity:1;}
  100%{transform:scale(1) rotate(0deg);opacity:0;}
}
#coin-animation{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:6rem;
  color:var(--accent);
  pointer-events:none;
  opacity:0;
  z-index:3000;
}
#coin-animation.show{
  animation:coinFlip 1s ease forwards;
}
@keyframes coinFlip{
  0%{transform:scale(0) rotateY(0);opacity:0;}
  50%{transform:scale(1.2) rotateY(180deg);opacity:1;}
  100%{transform:scale(1) rotateY(360deg);opacity:0;}
}
#sp-animation{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:8rem;
  color:var(--accent-2);
  pointer-events:none;
  opacity:0;
  z-index:3000;
}
#sp-animation.show{
  animation:spPulse 1s ease forwards;
}
@keyframes spPulse{
  0%{transform:scale(0);opacity:0;}
  30%{transform:scale(1.2);opacity:1;}
  100%{transform:scale(1);opacity:0;}
}
.sp-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;flex:1;}
.sp-grid .btn-sm{width:100%;}
.card{border:1px solid var(--line);border-radius:var(--radius);padding:12px;display:flex;flex-direction:column;gap:10px;cursor:grab;transition:box-shadow .2s ease,transform .2s ease}
.card:hover{box-shadow:0 12px 28px rgba(0,0,0,.45);transform:translateY(-2px)}
.card.dragging{opacity:.5}
.catalog{max-height:360px;overflow:auto;border:1px dashed var(--line);border-radius:10px;padding:6px}
.perk-list{margin:0;padding-left:20px;list-style:disc}
.feature-list{margin:0 0 12px;padding-left:20px;list-style:disc}
.catalog-item{display:grid;grid-template-columns:auto 1fr auto;gap:10px;align-items:center;padding:8px;border-bottom:1px solid var(--line)}
.catalog-item:last-child{border-bottom:none}
.catalog-item.active{background:var(--accent);color:var(--text-on-accent)}
.catalog-item.active .pill{border-color:var(--text-on-accent);color:var(--text-on-accent)}
.small{font-size:.9rem;color:var(--muted)}
#modal-rules .pdf-controls{position:absolute;bottom:16px;right:16px;display:flex;flex-direction:column;gap:8px;z-index:1}
.overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.6);backdrop-filter:blur(2px);z-index:1000;padding:16px;opacity:1;pointer-events:auto;transition:opacity .2s ease}
.overlay.hidden{opacity:0;pointer-events:none}
.modal{background:var(--surface);border:1px solid var(--accent);border-radius:var(--radius);max-width:720px;width:100%;padding:16px;box-shadow:var(--shadow);position:relative;max-height:calc(100vh - 32px);overflow:auto;transform:scale(1);opacity:1;transition:transform .2s ease,opacity .2s ease}
.overlay.hidden .modal{transform:scale(.95);opacity:0}
.modal h3{margin:0 0 4px;color:var(--accent);font-size:.9rem;line-height:1.2;font-weight:600}
.modal .x{position:sticky;top:8px;margin-left:auto;margin-right:8px;background:transparent;border:none;color:inherit;cursor:pointer;display:flex;align-items:center;justify-content:center;width:32px;height:32px;transition:var(--transition);z-index:2}
.modal .x:hover{color:var(--accent)}
.modal .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}
#modal-rules{align-items:stretch;padding:0}
#modal-rules .modal-rules{max-width:none;width:100%;height:100%;border-radius:0;border:none;padding:0;max-height:none}
#modal-rules .modal-rules canvas{width:100%;height:100%;display:block}
.toast{position:fixed;bottom:18px;right:18px;background:var(--surface);border:1px solid var(--accent);padding:10px 12px;border-radius:var(--radius);opacity:0;transform:translateY(8px);transition:opacity .2s,transform .2s;z-index:2000}
.toast.show{opacity:1;transform:translateY(0)}
.toast.success{border-color:var(--success);color:var(--success)}
.toast.error{border-color:var(--error);color:var(--error)}

/* ability grid */
.ability-grid{grid-template-columns:repeat(2,1fr)}

.ability-box{
  border:1px solid var(--line);
  border-radius:var(--radius);
  padding:8px;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:6px;
}

.ability-box label{
  margin-bottom:0;
}

.ability-box .score{
  position:relative;
  width:100%;
}

.ability-box select{
  width:100%;
  height:72px;
  font-size:1.8rem;
  text-align:center;
}

.ability-box .score-val{
  display:flex;
  align-items:center;
  justify-content:center;
  width:100%;
  height:72px;
  font-size:1.8rem;
  border:1px solid var(--line);
  border-radius:var(--radius);
}

.ability-box .mod{
  position:absolute;
  bottom:4px;
  right:4px;
  padding:4px 6px;
  border:1px solid var(--accent);
  border-radius:var(--radius);
  background:var(--surface-2);
  color:var(--accent);
  font-size:.85rem;
}

#hp-roll-list{
  margin:8px 0 0;
  padding:0;
  list-style:none;
}
#hp-roll-list li{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-top:4px;
}
#hp-roll-list li button{
  flex:0 0 auto;
}

/* Enhanced form control feedback */
input:not([type="checkbox"]):hover,
select:hover,
textarea:hover{
  border-color:var(--accent-2);
}

input:not([type="checkbox"]):focus,
select:focus,
textarea:focus{
  border-color:var(--accent);
  box-shadow:0 0 0 2px rgba(59,130,246,.5);
  outline:none;
}

/* Validation states */
input:not([type="checkbox"]):invalid,
textarea:invalid{
  border-color:#dc2626;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='none' stroke='%23dc2626' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 6l8 8M6 14l8-8'/%3E%3C/svg%3E");
  background-repeat:no-repeat;
  background-position:right 12px center;
  background-size:16px;
  padding-right:40px;
}

select:invalid{
  border-color:#dc2626;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='none' stroke='%23dc2626' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 6l8 8M6 14l8-8'/%3E%3C/svg%3E"),var(--chevron);
  background-repeat:no-repeat,no-repeat;
  background-position:right 12px center,right 36px center;
  background-size:16px 16px,16px 16px;
  padding-right:64px;
}

input:not([type="checkbox"])[required]:valid:not(:placeholder-shown),
textarea[required]:valid:not(:placeholder-shown){
  border-color:#16a34a;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='none' stroke='%2316a34a' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M5 10l3 3 7-7'/%3E%3C/svg%3E");
  background-repeat:no-repeat;
  background-position:right 12px center;
  background-size:16px;
  padding-right:40px;
}

select[required]:valid{
  border-color:#16a34a;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='none' stroke='%2316a34a' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M5 10l3 3 7-7'/%3E%3C/svg%3E"),url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 8l4 4 4-4'/%3E%3C/svg%3E");
  background-repeat:no-repeat,no-repeat;
  background-position:right 12px center,right 36px center;
  background-size:16px 16px,16px 16px;
  padding-right:64px;
}

/* wizard */
.wizard-step{display:none;opacity:0;transform:translateX(10px)}
.wizard-step.active{display:block;animation:wizardFade .3s ease forwards}
@keyframes wizardFade{to{opacity:1;transform:translateX(0)}}
.wizard-nav{display:flex;justify-content:space-between;align-items:center;margin-top:16px}
#wizard-progress{flex:1;text-align:center}
